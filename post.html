<!DOCTYPE html>
<html lang="en" class="">
<head>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="text-slate-800 dark:text-slate-300 antialiased">

    <main id="content-container" class="w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <div class="flex flex-col lg:flex-row lg:space-x-8 space-y-8 lg:space-y-0">
            
            <article class="flex-1">
                <div class="relative bg-white/70 backdrop-blur-sm dark:bg-slate-800/70 border border-slate-200 dark:border-slate-700 rounded-2xl shadow-lg p-8 md:p-12 overflow-hidden main-card">
                    <div class="mb-8">
                        <a href="index.html" class="text-sky-500 hover:underline">&larr; Back to all posts</a>
                    </div>
                    
                    <div id="post-content-container">
                        <p class="text-slate-500">Loading post...</p>
                    </div>
                </div>
            </article>

            <aside class="w-full lg:w-80 flex-shrink-0">
                </aside>
        </div>
    </main>
    
    <script>
        async function loadSinglePost() {
            const postContainer = document.getElementById('post-content-container');
            const params = new URLSearchParams(window.location.search);
            const postFile = params.get('p'); // Gets 'posts/my-first-post.md' from the URL

            if (!postFile) {
                postContainer.innerHTML = "<h2>Post not found.</h2><p>Please check the URL and try again.</p>";
                return;
            }

            try {
                // Fetch all posts to find the metadata for this specific post
                const response = await fetch('posts.json');
                const posts = await response.json();
                const postMeta = posts.find(post => post.file === postFile);

                if (!postMeta) {
                     postContainer.innerHTML = "<h2>Post not found.</h2><p>Could not find this post in the manifest.</p>";
                    return;
                }

                // Now fetch the actual Markdown content of the post
                const postResponse = await fetch(postFile);
                const postMarkdown = await postResponse.text();
                const postHtml = marked.parse(postMarkdown); // Convert Markdown to HTML

                // Format the date
                const postDate = new Date(postMeta.date).toLocaleDateString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric'
                });

                // Display the full post
                postContainer.innerHTML = `
                    <div class="prose prose-lg dark:prose-invert max-w-none">
                        <h1><strong>${postMeta.title}</strong></h1>
                        <p class="text-base text-slate-500 dark:text-slate-400 mt-0">${postDate}</p>
                        ${postHtml}
                    </div>
                `;

            } catch (error) {
                postContainer.innerHTML = "<h2>Error</h2><p>Sorry, there was a problem loading this post.</p>";
                console.error("Error loading single post:", error);
            }
        }

        // Run the function when the page loads
        window.addEventListener('load', loadSinglePost);
    </script>
</body>
</html>
