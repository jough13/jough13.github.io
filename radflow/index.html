<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RadFlow | Loading...</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
</head>
<body>

<div class="sidebar">
    <div style="font-size:1.2rem; font-weight:800; color:var(--accent); margin-bottom:2rem; display:flex; align-items:center; gap:10px;">
        <i class="fa-solid fa-atom"></i> <span id="app-title-display">RadFlow</span>
    </div>
    
    <div id="mobile-nav-wrapper" style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; width:100%; margin-bottom: 1rem;">
        
        <div class="nav-item active" id="nav-dash" onclick="nav('dashboard')">
            <i class="fa-solid fa-gauge-high"></i> <span class="nav-text">Dash</span>
        </div>
        
        <div class="nav-item" id="nav-proj" onclick="nav('projects')">
            <i class="fa-solid fa-list-check"></i> <span class="nav-text">Proj</span>
        </div>
        
        <div class="nav-item" id="nav-fin" onclick="nav('finance')">
            <i class="fa-solid fa-sack-dollar"></i> <span class="nav-text">Cost</span>
        </div>
        
        <div class="nav-item" id="nav-est" onclick="nav('estimator')">
            <i class="fa-solid fa-file-invoice-dollar"></i> <span class="nav-text">Est.</span>
        </div>
        
        <div class="nav-item" id="nav-inv" onclick="nav('inventory')">
            <i class="fa-solid fa-boxes-stacked"></i> <span class="nav-text">Inv</span>
        </div>
        
        <div class="nav-item" id="nav-exempt" onclick="nav('exempt')">
            <i class="fa-solid fa-recycle"></i> <span class="nav-text">Exempt</span>
        </div>
        
        <div class="nav-item" id="nav-hp" onclick="nav('hp')">
            <i class="fa-solid fa-calculator"></i> <span class="nav-text">HP</span>
        </div>
        
        <div class="nav-item" id="nav-log" onclick="nav('logbook')">
            <i class="fa-solid fa-book-open"></i> <span class="nav-text">Log</span>
        </div>

        <div class="nav-item" id="nav-refs" onclick="nav('references')">
            <i class="fa-solid fa-book-bookmark"></i> <span class="nav-text">Refs</span>
        </div>

        <div class="nav-item" onclick="openModal('guideModal')">
            <i class="fa-solid fa-circle-question"></i> <span class="nav-text">Guide</span>
        </div>

        <div class="nav-item mobile-only" id="nav-chat" onclick="nav('chat')">
            <i class="fa-solid fa-comments"></i> <span class="nav-text">Chat</span>
        </div>

        <div class="nav-item mobile-only" onclick="openModal('settingsModal')">
            <i class="fa-solid fa-bars"></i> <span class="nav-text">Menu</span>
        </div>
    </div>

    <button class="btn-toggle" onclick="window.print()"><i class="fa-solid fa-print"></i> Report</button>
    <button class="btn-toggle" onclick="openImportModal()"><i class="fa-solid fa-paste"></i> Import Data</button>
    <button class="btn-toggle" onclick="openExportModal()"><i class="fa-solid fa-copy"></i> Export Data</button>
    <button class="btn-toggle" onclick="openModal('settingsModal')"><i class="fa-solid fa-gear"></i> Settings</button>

    <div style="margin-top:auto; font-size:0.8rem; color:var(--text-muted); text-align:center; padding-top:10px; border-top:1px solid var(--border);">
        Logged in as: <b id="sidebar-user-display">...</b>
    </div>
</div>

<div class="main">
    <div id="view-dashboard" class="view-section active">
        <div class="header">
            <div><h1 style="margin:0;">Command Center</h1><p style="margin:0; color:var(--text-muted);" id="todayDate">Loading...</p></div>
            
            <div style="position:relative; display:inline-block; width:300px;">
    <input type="text" class="search-bar" id="main-search" style="width:100%; padding-right:30px;" placeholder="Search..." onkeyup="handleSearch(this.value)">
    <i class="fa-solid fa-xmark" 
       onclick="document.getElementById('main-search').value=''; handleSearch('');"
       style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; color:var(--text-muted); padding:5px;"
       title="Clear Search"></i>
</div>

            <button class="btn" onclick="openModal('projectModal')">+ Project</button>
        </div>
        
        <div class="widget">
            <div class="widget-head">Operational Analytics</div>
            <div class="dashboard-grid">
                <div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">PROJECT STATUS</div>
                    <div id="chart-proj" class="chart-container"></div>
                    <div id="legend-proj" class="chart-legend"></div>
                </div>
                <div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">BUDGET UTILIZATION</div>
                    <div id="chart-money" class="chart-container"></div>
                    <div class="chart-legend"><div><span class="legend-dot" style="background:var(--money)"></span>Spent</div><div><span class="legend-dot" style="background:var(--bg-input)"></span>Remaining</div></div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="widget"><div class="widget-head"><span>Active Projects</span><span style="font-size:0.8rem; cursor:pointer; color:var(--accent);" onclick="nav('projects')">View All &rarr;</span></div><div id="dash-projects"></div></div>
            <div class="widget"><div class="widget-head"><span>Pending Actions</span><i class="fa-solid fa-bolt" style="color:var(--warning)"></i></div><div id="dash-tasks"></div></div>
            <div class="widget"><div class="widget-head">Inventory Snapshot</div><div id="dash-inv"></div></div>
            <div class="widget"><div class="widget-head">Financial Snapshot</div><div id="dash-fin"></div></div>
        </div>
    </div>

    <div id="view-project-detail" class="view-section"></div>

    <div id="view-all-tasks" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Action Items Master List</h1>
            </div>
            
            <div style="display:flex; gap:10px;">
                <button id="btnTaskShowDone" class="btn-toggle" style="margin:0; width:auto;" onclick="toggleMasterTasksDone()">
                    <i class="fa-solid fa-eye"></i> Show Done
                </button>
                
                <input type="text" class="search-bar" style="width:200px;" placeholder="Search Tasks..." onkeyup="handleSearch(this.value)">
            </div>
        </div>
        <div class="widget">
            <div style="overflow-x:auto;">
                <table class="sci-table" id="table-all-tasks">
                    <thead>
                        <tr>
                            <th style="width:50px;">Done</th>
                            <th onclick="sortTable('table-all-tasks', 1)">Priority <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('table-all-tasks', 2)">Task <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('table-all-tasks', 3)">Project <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('table-all-tasks', 4)">Assignee <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('table-all-tasks', 5)">Due <i class="fa-solid fa-sort"></i></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="full-task-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="view-projects" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">All Projects</h1>
            </div>

            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <button class="btn" onclick="openModal('projectModal')">+ Project</button>
                
                <select class="sort-select" style="margin:0; width:auto; height:34px;" onchange="setMainProjSort(this.value)">
                    <option value="status">Sort: Status</option>
                    <option value="health">Sort: Health</option>
                    <option value="due">Sort: Due Date</option>
                    <option value="title">Sort: Name (A-Z)</option>
                    <option value="newest">Sort: Newest</option>
                    <option value="oldest">Sort: Oldest</option>
                </select>

                <button class="btn-toggle" style="margin:0; width:auto;" onclick="toggleProjView()">
                    <i class="fa-solid fa-table-columns"></i> View
                </button>
                
                <button id="btnShowComp" class="btn-toggle" style="margin:0; width:auto;" onclick="toggleShowComp()">
                    <i class="fa-solid fa-eye"></i> Show Done
                </button>
                
                <input type="text" class="search-bar" style="width:150px;" placeholder="Filter..." onkeyup="handleSearch(this.value)">
            </div>
        </div>
        <div class="widget"><div id="full-project-list"></div></div>
    </div>
    
<div id="view-finance" class="view-section">
        <div class="header">
            <div>
                <div style="display:flex; align-items:center; gap:15px;">
                    <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h1 style="margin:0;">Cost Tracker</h1>
                </div>
                <div style="display:flex; gap:8px; align-items:center; margin-top:5px; font-size:0.8rem; color:var(--text-muted);">
                    <span><i class="fa-solid fa-filter"></i> Period:</span>
                    
                    <input type="date" id="fin-start" class="form-control" style="width:auto; padding:2px 5px; margin:0; height:auto;">
                    <span>to</span>
                    <input type="date" id="fin-end" class="form-control" style="width:auto; padding:2px 5px; margin:0; height:auto;">
                    
                    <button class="qa-btn" onclick="applyFinFilter()" title="Apply" style="background:var(--accent); color:white;">
                        <i class="fa-solid fa-check"></i>
                    </button>
                    <button class="qa-btn" onclick="clearFinFilter()" title="Clear">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                
                    <div style="border-left:1px solid var(--border); padding-left:8px; margin-left:4px;">
                        <button id="btn-budget-scope" class="btn-rect" onclick="toggleBudgetScope()" style="width:110px; background:var(--navy); color:white;">
                            <i class="fa-solid fa-infinity"></i> Lifetime
                        </button>
                    </div>
                </div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn" onclick="openModal('allocModal')">+ Funding</button>
                <button class="btn" onclick="openModal('expenseModal')">- Expense</button>
                <button class="btn-toggle" style="margin:0" onclick="downloadCSV()"><i class="fa-solid fa-file-csv"></i> to Excel</button>
            </div>
        </div>
        
        <div class="fin-grid">
            <div class="fin-card interactive" onclick="openBudgetManager()"><div class="fin-label">Total Budget <i class="fa-solid fa-pen" style="font-size:0.7rem; margin-left:5px;"></i></div><div class="fin-val" style="color:var(--info);" id="fin-total-budget">$0.00</div></div>
            <div class="fin-card"><div class="fin-label">Total Spent</div><div class="fin-val" style="color:var(--warning);" id="fin-total-spent">$0.00</div></div>
            <div class="fin-card"><div class="fin-label">Remaining Funds</div><div class="fin-val" id="fin-total-rem">$0.00</div></div>
            <div class="fin-card"><div class="fin-label">Active Spenders</div><div class="fin-val" style="color:var(--rad);" id="fin-proj-count">0</div></div>
        </div>
        
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button class="btn-toggle" style="width:auto;" onclick="switchFinTab('overview')">Overview</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchFinTab('exp')">Expenses</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchFinTab('alloc')">Allocations</button>
        </div>

        <div class="widget">
            <div id="fin-tab-overview">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="widget-head" style="margin:0;">Spending Trend</div>
                        <button class="qa-btn" onclick="expandChart()" title="Fullscreen"><i class="fa-solid fa-expand"></i></button>
                    </div>
                    <div style="display:flex; gap:5px; background:var(--bg-input); padding:3px; border-radius:6px;">
                        <button class="btn-rect" onclick="setChartScale('week')" id="btn-scale-week" style="width:auto;">Wk</button>
                        <button class="btn-rect" onclick="setChartScale('month')" id="btn-scale-month" style="width:auto; background:var(--accent); color:white;">Mo</button>
                        <button class="btn-rect" onclick="setChartScale('quarter')" id="btn-scale-quarter" style="width:auto;">Qr</button>
                        <button class="btn-rect" onclick="setChartScale('year')" id="btn-scale-year" style="width:auto;">Yr</button>
                    </div>
                </div>
                
                <div id="monthly-spend-chart" class="bar-chart-v"></div>

                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px; margin-top: 20px;">
                    <div>
                        <div class="widget-head">Budget Rollup & Performance</div>
                        <div style="overflow-x:auto;">
                            <table class="sci-table" id="table-budget">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('table-budget', 0)">Project <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 1)" style="width:50px; cursor:pointer;">
    Source <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i>
</th>
                                        <th onclick="sortTable('table-budget', 2)" style="text-align:right">Initial Budget <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 3)" style="text-align:right">Adjustments <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 4)" style="text-align:right">Total Funding <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 5)" style="text-align:right">Total Spent <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 6)" style="text-align:right">Remaining <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                        <th onclick="sortTable('table-budget', 7)" style="text-align:center">Burn % <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="budget-rollup-list"></tbody>
                                <tfoot id="budget-rollup-foot" style="font-weight:bold; background:var(--bg-input); border-top:2px solid var(--border);"></tfoot>
                            </table>
                        </div>
                    </div>
                    <div style="background:var(--bg-card); border-left:1px solid var(--border); padding-left:20px;">
                        <div class="widget-head">Funding Source Analysis</div>
                        <div id="finance-source-breakdown">Loading...</div>
                    </div>
                </div>
            </div>

            <div id="fin-tab-exp" style="display:none;">
                <div class="widget-head">Expense Log (Live Edit)</div>
                <div style="overflow-x:auto;"><table class="sci-table" id="table-exp"><thead><tr><th onclick="sortTable('table-exp',0)">Date <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-exp',1)">Project <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-exp',2)">Funding Source <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-exp',3)">Description <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-exp',4)">Amount <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th>Status</th><th></th></tr></thead><tbody id="expense-list"></tbody></table></div>
            </div>
            
            <div id="fin-tab-alloc" style="display:none;">
                <div class="widget-head">Funding Allocations</div>
                <div style="overflow-x:auto;"><table class="sci-table" id="table-alloc"><thead><tr><th onclick="sortTable('table-alloc',0)">Date <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-alloc',1)">Project <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-alloc',2)">Source <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-alloc',3)">Description <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th onclick="sortTable('table-alloc',4)">Amount <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th><th></th></tr></thead><tbody id="alloc-list"></tbody></table></div>
            </div>
        </div>
    </div>
    <div id="view-estimator" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Discard & Exit">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Cost Estimator</h1>
            </div>

            <div style="display:flex; gap:10px;">
                <select id="est-proj-select" class="form-control" style="width:200px; margin:0;" onchange="saveLocally()"><option value="">-- Select Project --</option></select>
                <select id="est-fund-select" class="form-control" style="width:180px; margin:0;">
                    <option>Navy General Fund</option><option>Command Funded</option><option>Other</option>
                </select>
                <button class="btn-sync" style="width:auto; margin:0;" onclick="clearEstimate()"><i class="fa-solid fa-trash"></i></button>
                
                <button class="btn" style="background:var(--text-muted)" onclick="saveEstimateAction('estimate')" title="Save as line item (No budget impact)">As Estimate</button>
                <button class="btn" style="background:var(--money)" onclick="saveEstimateAction('funding')" title="Add to Project Funding">As Funding</button>
                <button class="btn" style="background:var(--danger)" onclick="saveEstimateAction('expense')" title="Submit as Expense">As Cost</button>
            </div>
        </div>
        <div class="widget">
            <div class="widget-head">Estimate Line Items</div>
            <div class="est-input-row" style="display:flex; gap:10px; margin-bottom:10px; align-items:center; flex-wrap:wrap;">
                <select id="est-cat" class="form-control" style="margin:0; width:150px;" onchange="updateEstItems()"><option value="disposal">Disposal</option><option value="container">Container</option><option value="sample">Sampling</option><option value="labor">Labor</option><option value="trans">Transportation</option></select>
                <select id="est-item" class="form-control" style="margin:0; width:200px;" onchange="updateEstUnit()"></select>
                <div style="display:flex; align-items:center; gap:5px;">
                    <span style="font-size:0.8rem; color:var(--text-muted);">Rate: $</span>
                    <input id="est-rate" type="number" step="0.01" class="form-control" style="margin:0; width:100px;" placeholder="0.00">
                </div>
                <div style="display:flex; align-items:center; gap:5px;">
                    <input id="est-qty" type="number" class="form-control" style="margin:0; width:80px;" placeholder="0">
                    <span id="est-unit" style="font-size:0.8rem; color:var(--text-muted); width:80px;">Units</span>
                </div>
                <button class="btn" onclick="addEstItem()">Add</button>
            </div>
            <div style="overflow-x:auto;">
                <table class="sci-table">
                    <thead><tr><th>Category</th><th>Item</th><th style="text-align:right">Rate</th><th style="text-align:right">Qty/Hrs</th><th style="text-align:right">Total</th><th></th></tr></thead>
                    <tbody id="est-list"></tbody>
                    <tfoot style="font-weight:bold; background:var(--bg-input);">
                        <tr style="font-size:1.1rem; color:var(--accent); border-top:2px solid var(--border);"><td colspan="4" style="text-align:right">ESTIMATE TOTAL (<span id="est-count">0</span> items):</td><td style="text-align:right" id="est-grand-total">$0.00</td><td></td></tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <div id="view-exempt" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Exempt Material Disposal Log</h1>
            </div>
            <div style="display:flex; gap:10px;">
                <input type="text" class="search-bar" style="width:200px;" placeholder="Search Log..." onkeyup="handleSearch(this.value)">
                <button class="btn-toggle" style="margin:0" onclick="downloadExemptCSV()"><i class="fa-solid fa-file-csv"></i> Export Log</button>
                <button class="btn" onclick="openModal('exemptModal')">+ Add Entry</button>
            </div>
        </div>
        <div class="widget">
            <div style="overflow-x:auto;">
    <table class="sci-table" id="table-exempt">
    <thead>
        <tr>
            <th onclick="sortTable('table-exempt', 0)">Log # <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 1)">Date Rec'd <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th> 
            <th onclick="sortTable('table-exempt', 2)">Command <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 3)">Description <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 4)">Nuclide <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 5)">Activity <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 6)">Basis <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 7)">Pathway <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th>
            <th onclick="sortTable('table-exempt', 8)">Auth Date <i class="fa-solid fa-sort" style="font-size:0.7rem; color:var(--text-muted)"></i></th> 
            <th>Status</th>
            <th></th>
        </tr>
    </thead>
    <tbody id="exempt-list"></tbody>
</table>
            </div>
        </div>
    </div>

    <div id="view-hp" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">HP Tools</h1>
            </div>
        </div>
        <div class="widget" style="margin-bottom:1.5rem; background:var(--bg-panel); border-left: 4px solid var(--accent);">
            <div class="widget-head" style="margin-bottom:5px;">Quick Converter</div>
            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="conv-in" type="number" class="form-control" style="margin:0; width:120px;" placeholder="Value" onkeyup="runConv()">
                <select id="conv-type" class="form-control" style="margin:0; width:150px;" onchange="runConv()">
                    <option value="ci-gbq">Ci &rarr; GBq</option>
                    <option value="gbq-ci">GBq &rarr; Ci</option>
                    <option value="mr-usv">mR &rarr; &mu;Sv</option>
                    <option value="usv-mr">&mu;Sv &rarr; mR</option>
                </select>
                <div style="font-weight:bold;">&rarr;</div>
                <div id="conv-out" style="font-weight:bold; color:var(--accent); min-width:80px;">0.00</div>
            </div>
        </div>

        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <button class="btn-toggle" style="width:auto;" onclick="switchHpTab('decay')">Decay</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchHpTab('dist')">Distance</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchHpTab('shield')">Shielding</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchHpTab('stay')">Stay Time</button>
            <button class="btn-toggle" style="width:auto;" onclick="switchHpTab('alara')">ALARA Plan</button>
        </div>
        <div class="widget">
            <div id="hp-tab-decay">
                <div class="widget-head">Isotope Decay</div>
                <div class="dashboard-grid">
                    <div>
    <label style="color:var(--text-muted); font-size:0.8rem;">Isotope</label>
    <select id="calc-iso" class="form-control" onchange="saveHPState()"></select>
    
    <label style="color:var(--text-muted); font-size:0.8rem;">Initial Activity (mCi)</label>
    <input type="number" id="calc-a0" class="form-control" placeholder="100" onchange="saveHPState()">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1;">
            <label style="color:var(--text-muted); font-size:0.8rem;">Reference Date</label>
            <input type="date" id="calc-date" class="form-control" onchange="saveHPState()">
        </div>
        <div style="flex:1;">
            <label style="color:var(--text-muted); font-size:0.8rem;">Target Date (Default: Now)</label>
            <input type="date" id="calc-target-date" class="form-control" onchange="saveHPState()">
        </div>
    </div>

    <button class="btn" onclick="calculateDecay()" style="width:100%; background:var(--rad);">Calculate</button>
</div>
                    <div style="text-align:center; background:var(--bg-card); padding:20px; border-radius:10px; display:flex; flex-direction:column; justify-content:center;">
                        <div style="color:var(--text-muted);">Current Activity</div>
                        <div id="calc-result" style="font-size:2.5rem; color:var(--rad); font-weight:bold; margin:10px 0;">---</div>
                    </div>
                </div>
            </div>
            <div id="hp-tab-dist" style="display:none;">
                <div class="widget-head">Inverse Square Law</div>
                <div style="margin-bottom:15px; padding:10px; background:var(--bg-input); border-radius:6px;">
                    <label style="font-size:0.7rem; font-weight:bold; color:var(--accent);">LOAD FROM INVENTORY</label>
                    <div style="display:flex; gap:10px;">
                        <select id="dist-inv-select" class="form-control" style="margin:0;"></select>
                        <button class="btn" onclick="loadInvToCalc()">Load</button>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <div>
                        <label style="color:var(--text-muted); font-size:0.8rem;">Dose Rate (mR/hr)</label><input type="number" id="dist-d1" class="form-control" placeholder="Rate at source">
                        <label style="color:var(--text-muted); font-size:0.8rem;">Distance 1 (ft/m)</label><input type="number" id="dist-r1" class="form-control" placeholder="Initial Dist (e.g. 1)">
                        <label style="color:var(--text-muted); font-size:0.8rem;">Target Distance (ft/m)</label><input type="number" id="dist-r2" class="form-control" placeholder="New Dist">
                        <button class="btn" onclick="calcInverseSquare()" style="width:100%; background:var(--info);">Calculate New Rate</button>
                    </div>
                    <div style="text-align:center; background:var(--bg-card); padding:20px; border-radius:10px; display:flex; flex-direction:column; justify-content:center;">
                        <div style="color:var(--text-muted);">Resulting Dose Rate</div>
                        <div id="dist-result" style="font-size:2.5rem; color:var(--info); font-weight:bold; margin:10px 0;">---</div>
                        <div id="dist-formula" style="font-size:0.8rem; color:var(--text-muted);">I₁ / (d₂/d₁)²</div>
                    </div>
                </div>
            </div>
            <div id="hp-tab-shield" style="display:none;">
                <div class="widget-head">Shielding Attenuation</div>
                <div class="dashboard-grid">
                    <div>
                        <div class="input-grid">
                            <div><label style="color:var(--text-muted); font-size:0.8rem;">Isotope (Data available for: Co-60, Cs-137, Ir-192)</label><select id="shield-iso" class="form-control"><option value="Co-60">Co-60</option><option value="Cs-137">Cs-137</option><option value="Ir-192">Ir-192</option></select></div>
                            <div><label style="color:var(--text-muted); font-size:0.8rem;">Material</label><select id="shield-mat" class="form-control"><option value="Pb">Lead (Pb)</option><option value="Fe">Iron (Fe)</option><option value="Conc">Concrete</option></select></div>
                        </div>
                        <label style="color:var(--text-muted); font-size:0.8rem;">Initial Dose Rate (mR/hr)</label><input type="number" id="shield-i0" class="form-control" placeholder="1000">
                        <label style="color:var(--text-muted); font-size:0.8rem;">Shield Thickness (cm)</label><input type="number" id="shield-x" class="form-control" placeholder="1.0">
                        <button class="btn" onclick="calcShielding()" style="width:100%; background:var(--comp);">Calculate Shielding</button>
                    </div>
                    <div style="text-align:center; background:var(--bg-card); padding:20px; border-radius:10px; display:flex; flex-direction:column; justify-content:center;">
                        <div style="color:var(--text-muted);">Attenuated Rate</div>
                        <div id="shield-result" style="font-size:2.5rem; color:var(--comp); font-weight:bold; margin:10px 0;">---</div>
                        <div id="shield-hvl" style="font-size:0.8rem; color:var(--text-muted);">HVL Used: -</div>
                    </div>
                </div>
            </div>
            <div id="hp-tab-stay" style="display:none;">
                <div class="widget-head">Stay Time Calculator</div>
                <div class="dashboard-grid">
                    <div>
                        <label style="color:var(--text-muted); font-size:0.8rem;">Field Dose Rate (mR/hr)</label>
                        <input type="number" id="stay-rate" class="form-control" placeholder="500">
                        <label style="color:var(--text-muted); font-size:0.8rem;">Available Dose Margin (mR)</label>
                        <input type="number" id="stay-limit" class="form-control" placeholder="100">
                        <button class="btn" onclick="calcStayTime()" style="width:100%; background:var(--navy);">Calculate Time</button>
                    </div>
                    <div style="text-align:center; background:var(--bg-card); padding:20px; border-radius:10px; display:flex; flex-direction:column; justify-content:center;">
                        <div style="color:var(--text-muted);">Allowed Stay Time</div>
                        <div id="stay-result" style="font-size:2rem; color:var(--navy); font-weight:bold; margin:10px 0;">---</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">Limit / Rate</div>
                    </div>
                </div>
            </div>
            <div id="hp-tab-alara" style="display:none;">
                <div class="widget-head">ALARA Job Planner</div>
                <div class="dashboard-grid">
                    <div>
                        <div class="input-grid">
                            <div><label style="color:var(--text-muted); font-size:0.8rem;">Dose Rate (mR/hr)</label><input type="number" id="alara-rate" class="form-control" placeholder="100"></div>
                            <div><label style="color:var(--text-muted); font-size:0.8rem;">Crew Size</label><input type="number" id="alara-crew" class="form-control" placeholder="3"></div>
                        </div>
                        <label style="color:var(--text-muted); font-size:0.8rem;">Job Duration (Minutes)</label>
                        <input type="number" id="alara-time" class="form-control" placeholder="60">
                        <button class="btn" onclick="calcAlara()" style="width:100%; background:var(--rad);">Estimate Collective Dose</button>
                    </div>
                    <div style="text-align:center; background:var(--bg-card); padding:20px; border-radius:10px; display:flex; flex-direction:column; justify-content:center;">
                        <div style="color:var(--text-muted);">Total Collective Dose</div>
                        <div id="alara-result" style="font-size:2rem; color:var(--rad); font-weight:bold; margin:10px 0;">---</div>
                        <div id="alara-indiv" style="font-size:0.8rem; color:var(--text-muted);">Individual: ---</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-logbook" class="view-section"><div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Logbook & Notes</h1>
            </div>
        </div>
    <div class="widget" style="height: calc(100vh - 150px);">

<textarea id="wiki-text" class="live-edit" style="width:100%; height:100%; resize:none; font-family:monospace; padding:15px;" placeholder="Type your persistent notes here..." oninput="saveWiki()"></textarea>

</div></div>

<div id="view-references" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Reference Library</h1>
            </div>
            <div style="display:flex; gap:10px;">
                <input type="text" class="search-bar" style="width:200px;" placeholder="Search Library..." onkeyup="handleSearch(this.value)">
                <button class="btn" onclick="openModal('refModal')">+ Add Link</button>
            </div>
        </div>
        
        <div class="widget">
            <div style="display:flex; gap:10px; margin-bottom:15px; overflow-x:auto; padding-bottom:5px;">
                <button class="btn-rect" onclick="filterRefs('all')" id="btn-ref-all" style="background:var(--accent); color:white; border:none;">All</button>
                <button class="btn-rect" onclick="filterRefs('Reg')" id="btn-ref-Reg">Regulations</button>
                <button class="btn-rect" onclick="filterRefs('Trans')" id="btn-ref-Trans">Transport</button>
                <button class="btn-rect" onclick="filterRefs('Form')" id="btn-ref-Form">Forms</button>
                <button class="btn-rect" onclick="filterRefs('Site')" id="btn-ref-Site">Site Docs</button>
            </div>
            
            <div id="ref-grid" class="dashboard-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));"></div>
        </div>
    </div>

    <div id="refModal" class="modal-overlay">
        <div class="modal">
            <h3>Add Reference Link</h3>
            <label style="font-size:0.7rem; color:var(--text-muted)">TITLE</label>
            <input id="refTitle" class="form-control" placeholder="e.g. Site Emergency Plan">
            
            <label style="font-size:0.7rem; color:var(--text-muted)">DESCRIPTION</label>
            <input id="refDesc" class="form-control" placeholder="Brief description...">
            
            <div class="input-grid">
                <div>
                    <label style="font-size:0.7rem; color:var(--text-muted)">CATEGORY</label>
                    <select id="refType" class="form-control">
                        <option value="Site">Site Doc</option>
                        <option value="Reg">Regulation</option>
                        <option value="Trans">Transport</option>
                        <option value="Form">Form</option>
                        <option value="Tool">Tool/Other</option>
                    </select>
                </div>
            </div>
            
            <label style="font-size:0.7rem; color:var(--text-muted)">URL / FILE PATH</label>
            <input id="refUrl" class="form-control" placeholder="https://... or file:///S:/...">
            
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px;">
                <button class="btn-sync" style="width:auto;" onclick="closeModal('refModal')">Cancel</button>
                <button class="btn" onclick="addReference()">Save Reference</button>
            </div>
        </div>
    </div>

    <div id="view-inventory" class="view-section">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <button class="btn-sync" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 12px;" title="Back to Dashboard">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 style="margin:0;">Inventory</h1>
            </div>
            <div>
                <button class="btn-toggle" onclick="downloadInvCSV()" style="width:auto; display:inline-block; margin:0; margin-right:5px;">
                    <i class="fa-solid fa-file-excel"></i> Export
                </button>
                
                <button class="btn-sync" onclick="decayInventory()" style="width:auto; display:inline-block; margin:0;">
                    <i class="fa-solid fa-clock-rotate-left"></i> Decay Correct
                </button>
                <button class="btn" onclick="openModal('invModal')" style="margin:0;">+ Add Item</button>
            </div>
        </div>

        <div id="bulk-toolbar" style="display:none; background:var(--navy); color:white; padding:10px 20px; border-radius:8px; margin-bottom:15px; align-items:center; justify-content:space-between; animation:slideIn 0.2s;">
        <div style="font-weight:bold; font-size:0.9rem;">
            <i class="fa-solid fa-check-double"></i> <span id="bulk-count">0</span> Selected
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn-rect" style="background:white; color:var(--navy); border:none;" onclick="bulkAction('status')">Set Status</button>
            <button class="btn-rect" style="background:white; color:var(--navy); border:none;" onclick="bulkAction('project')">Move to Proj</button>
            <button class="btn-rect" style="background:var(--danger); color:white; border:none;" onclick="bulkAction('delete')">Delete</button>
            <button class="btn-rect" style="background:transparent; color:white; border:1px solid rgba(255,255,255,0.5);" onclick="deselectAllInv()">Cancel</button>
        </div>
    </div>
        
        <div class="widget"><div id="full-inv-list"></div></div>

    </div>
</div>

<div class="chat-panel">
    <div class="chat-header" style="display:flex; align-items:center; justify-content:space-between;">
        <div><i class="fa-regular fa-comments"></i> Team Log</div>
        <button class="btn-sync mobile-only" onclick="nav('dashboard')" style="width:auto; margin:0; padding: 5px 10px; font-size:0.8rem;">
            <i class="fa-solid fa-xmark"></i> Close
        </button>
    </div>
    <div id="chatFeed" class="chat-feed"></div>
    <div class="chat-input-area"><input type="text" id="chatInput" class="form-control" placeholder="Update team..." onkeypress="handleChat(event)"></div>
</div>

<div id="graveyardModal" class="modal-overlay">
    <div class="modal" style="max-width:900px; height:85vh; display:flex; flex-direction:column; padding:0; overflow:hidden;">
        
        <div style="padding:15px 20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:var(--bg-card);">
            <div style="font-weight:bold; color:var(--text-muted); text-transform:uppercase; font-size:0.9rem;">
                <i class="fa-solid fa-database"></i> System Archives
            </div>
            <button class="btn-sync" style="width:auto; height:32px;" onclick="closeModal('graveyardModal')">Close</button>
        </div>

        <div id="graveyard-list" style="flex:1; overflow-y:auto; padding:30px; background:var(--bg-body);"></div>
    </div>
</div>

<div id="settingsModal" class="modal-overlay">
    <div class="modal">
        <h3>System Settings</h3>
        
        <div style="margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:15px;">
            <h4 style="margin-bottom:10px; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase;">Actions & Reports</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn-toggle" onclick="window.print()" style="margin:0; justify-content:center;"><i class="fa-solid fa-print"></i> Report</button>
                <button class="btn-toggle" onclick="closeModal('settingsModal'); openExportModal()" style="margin:0; justify-content:center;"><i class="fa-solid fa-copy"></i> Export</button>
                <button class="btn-toggle" onclick="closeModal('settingsModal'); openImportModal()" style="margin:0; justify-content:center;"><i class="fa-solid fa-paste"></i> Import</button>
                <button class="btn-toggle" onclick="closeModal('settingsModal'); openGraveyard()" style="margin:0; justify-content:center;"><i class="fa-solid fa-book-skull"></i> Graveyard</button>
            </div>
        </div>

        <div style="margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:15px;">
            <h4 style="margin-bottom:10px; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase;">Appearance</h4>
            <button class="btn-toggle" onclick="toggleTheme()" style="margin:0;"><i class="fa-solid fa-circle-half-stroke"></i> Toggle Dark/Light Mode</button>
        </div>

        <div style="margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:15px;">
             <h4 style="margin-bottom:10px; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase;">User Identity</h4>
             
             <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px; background:var(--bg-input); padding:10px; border-radius:6px;">
                 <div style="font-size:0.9rem;">I am:</div>
                 <select id="userIdentitySelect" class="form-control" style="margin:0; flex:1;" onchange="setCurrentUser(this.value)">
                     </select>
             </div>

             <h4 style="margin-bottom:10px; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase;">Edit Team List</h4>
             <div id="teamList" style="margin-bottom:10px; max-height:150px; overflow-y:auto;"></div>
             <div style="display:flex; gap:10px;">
                <input id="newMember" class="form-control" style="margin:0" placeholder="New Name/Initials">
                <button class="btn" onclick="addTeamMember()">Add</button>
             </div>
        </div>

        <div>
            <h4 style="margin-bottom:10px; color:var(--danger); font-size:0.8rem; text-transform:uppercase;">Danger Zone</h4>
            <div style="display:flex; gap:10px;">
                <button class="btn-sync btn-danger" style="width:auto;" onclick="closeModal('settingsModal'); clearData();">Clear All Data</button>
                <button class="btn-sync btn-ghost" style="width:auto;" onclick="closeModal('settingsModal'); resetData();">Reset to Defaults</button>
            </div>
        </div>

        <div style="text-align:right; margin-top:20px;">
            <button class="btn-sync" style="width:auto;" onclick="closeModal('settingsModal')">Close</button>
        </div>
    </div>
</div>

<div id="estimateViewModal" class="modal-overlay">
    <div class="modal" style="max-width:600px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3><i class="fa-solid fa-file-invoice"></i> Estimate Details</h3>
            <div id="ige-dl-btn-container"></div> </div>
        <div style="background:var(--bg-input); padding:10px; border-radius:6px; margin-bottom:15px; font-size:0.8rem; color:var(--text-muted);">
            <div id="ige-meta-desc" style="font-weight:bold; color:var(--text-main); margin-bottom:5px;"></div>
            <div id="ige-meta-date"></div>
        </div>
        <div style="max-height:300px; overflow-y:auto; border:1px solid var(--border); border-radius:4px;">
            <table class="sci-table">
                <thead>
                    <tr style="background:var(--bg-card); position:sticky; top:0;">
                        <th>Category</th><th>Item</th><th style="text-align:right">Rate</th><th style="text-align:right">Qty</th><th style="text-align:right">Total</th>
                    </tr>
                </thead>
                <tbody id="ige-view-list"></tbody>
            </table>
        </div>
        <div style="text-align:right; margin-top:10px;">
            <div style="font-weight:bold; font-size:1.1rem; color:var(--money);">Total: <span id="ige-view-total"></span></div>
        </div>
        <div style="text-align:right; margin-top:20px;">
            <button class="btn-sync" style="width:auto;" onclick="closeModal('estimateViewModal')">Close</button>
        </div>
    </div>
</div>

<div id="chartModal" class="modal-overlay">
    <div class="modal" style="width:95%; max-width:1200px; height:80vh; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3>Financial Analysis</h3>
            <button class="btn-sync" style="width:auto;" onclick="closeModal('chartModal')"><i class="fa-solid fa-xmark"></i> Close</button>
        </div>
        <div id="large-chart-container" style="flex:1; width:100%; overflow:hidden; display:flex; flex-direction:column;"></div>
    </div>
</div>

<div id="projectModal" class="modal-overlay">
    <div class="modal" style="max-width:600px;"> 
        <h3>New Project</h3>
        
        <input id="pTitle" class="form-control" placeholder="Project Name (e.g. Lab 4 Cleanout)" style="font-weight:bold;">
        <input id="pDesc" class="form-control" placeholder="Brief Description">
        
        <div class="input-grid">
            <div><label style="font-size:0.7rem; color:var(--text-muted)">UIC</label><input id="pUic" class="form-control" placeholder="N00000"></div>
            <div><label style="font-size:0.7rem; color:var(--text-muted)">LOCATION</label><input id="pLoc" class="form-control" placeholder="City, ST"></div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">REGION</label>
                <select id="pRegion" class="form-control">
                    <option value="">--</option>
                    <option>East</option><option>West</option><option>Far-East</option><option>Europe</option>
                </select>
            </div>
        </div>
        
        <div style="background:var(--bg-card); border:1px solid var(--border); padding:15px; border-radius:6px; margin-bottom:15px;">
            <label style="font-size:0.7rem; color:var(--text-muted); font-weight:bold; letter-spacing:0.5px;">PRIMARY POINT OF CONTACT</label>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input id="pPoc" class="form-control" style="margin:0; flex:1;" placeholder="Name">
                <input id="pPocEmail" class="form-control" style="margin:0; flex:1;" placeholder="Email">
                <input id="pPocPhone" class="form-control" style="margin:0; width:140px;" placeholder="Phone" oninput="maskPhone(event)">
            </div>

            <label style="font-size:0.7rem; color:var(--text-muted); font-weight:bold; letter-spacing:0.5px;">ALTERNATE POC</label>
            <div style="display:flex; gap:10px;">
                <input id="pPoc2" class="form-control" style="margin:0; flex:1;" placeholder="Alt Name">
                <input id="pPocEmail2" class="form-control" style="margin:0; flex:1;" placeholder="Alt Email">
                <input id="pPocPhone2" class="form-control" style="margin:0; width:140px;" placeholder="Alt Phone" oninput="maskPhone(event)">
            </div>
        </div>

        <div class="input-grid">
            <div><label style="font-size:0.7rem; color:var(--text-muted)">MIPR #</label><input id="pMipr" class="form-control" placeholder="N000..."></div>
            <div><label style="font-size:0.7rem; color:var(--text-muted)">JMC ID</label><input id="pJmc" class="form-control" placeholder="Tracking #"></div>
            <div><label style="font-size:0.7rem; color:var(--text-muted)">INITIAL BUDGET ($)</label><input id="pCost" type="number" step="0.01" class="form-control" placeholder="0.00"></div>
        </div>

        <div class="input-grid">
            <div style="flex:2;"><label style="font-size:0.7rem; color:var(--text-muted)">CONTRACTOR</label><input id="pCont" class="form-control" placeholder="Vendor Name"></div>
            <div style="flex:1;">
                <label style="font-size:0.7rem; color:var(--text-muted)">STATUS</label>
                <select id="pContStat" class="form-control">
                    <option>Pre-Prop</option><option>Out for Prop</option><option>On Contract</option>
                </select>
            </div>
        </div>

        <div style="border-top:1px dashed var(--border); margin-top:10px; padding-top:10px;">
            <div class="input-grid">
                <div><label style="font-size:0.7rem; color:var(--text-muted)">POP START</label><input id="pPopStart" type="date" class="form-control"></div>
                <div><label style="font-size:0.7rem; color:var(--text-muted)">POP END</label><input id="pPopEnd" type="date" class="form-control"></div>
                <div><label style="font-size:0.7rem; color:var(--text-muted)">DUE DATE</label><input id="pDate" type="date" class="form-control"></div>
            </div>
        </div>
        
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
            <button class="btn-sync" 
                    style="width:140px; height:38px; justify-content:center; align-items:center; margin:0;" 
                    onclick="closeModal('projectModal')">
                Cancel
            </button>
            
            <button class="btn" 
                    style="width:140px; height:38px; display:flex; justify-content:center; align-items:center; border:1px solid transparent; margin:0;" 
                    onclick="addProject()">
                Save Project
            </button>
        </div>
    </div>
</div>

<div id="expenseModal" class="modal-overlay"><div class="modal"><h3>Log Expense</h3><label style="font-size:0.7rem; color:var(--text-muted);">PROJECT</label><select id="expProj" class="form-control"></select><input id="expDesc" class="form-control" placeholder="Description"><div class="input-grid"><div style="flex:2;"><label style="font-size:0.7rem; color:var(--text-muted);">FUNDING SOURCE</label><select id="expFund" class="form-control"><option>Navy General Fund</option><option>Command Funded</option><option>Other</option></select></div><div style="flex:1;"><label style="font-size:0.7rem; color:var(--text-muted);">AMOUNT</label>
    <input id="expAmt" type="number" step="0.01" class="form-control" placeholder="0.00">
</div></div>

<div style="margin-bottom:10px;">
    <label style="font-size:0.7rem; color:var(--text-muted);">DATE</label>
    <input id="expDate" type="date" class="form-control"></div>
    
    <select id="expStatus" class="form-control"><option>Invoiced</option><option>Paid</option><option>Encumbered</option></select>

<div style="display:flex; justify-content:flex-end; gap:10px;">
    <button class="btn-sync" style="width:auto;" onclick="closeModal('expenseModal')">Cancel</button>
    <button class="btn" style="background:var(--info)" onclick="addExpense(true)">Save & Add Another</button>
    <button class="btn" onclick="addExpense(false)">Save</button>
</div>

</div></div>
<div id="allocModal" class="modal-overlay"><div class="modal"><h3>Add Funding Allocation</h3><label style="font-size:0.7rem; color:var(--text-muted);">PROJECT</label><select id="allocProj" class="form-control"></select><div class="input-grid"><div style="flex:2;"><label style="font-size:0.7rem; color:var(--text-muted);">SOURCE</label><select id="allocFund" class="form-control"><option>Navy General Fund</option><option>Command Funded</option><option>Other</option></select></div><div style="flex:1;"><label style="font-size:0.7rem; color:var(--text-muted);">AMOUNT</label>
    <input id="allocAmt" type="number" step="0.01" class="form-control" placeholder="0.00">
</div></div><input id="allocDesc" class="form-control" placeholder="Description (e.g. Q3 Top-up)"><div style="margin-bottom:10px;"><label style="font-size:0.7rem; color:var(--text-muted);">DATE</label><input id="allocDate" type="date" class="form-control"></div><div style="display:flex; justify-content:flex-end; gap:10px;"><button class="btn-sync" style="width:auto;" onclick="closeModal('allocModal')">Cancel</button><button class="btn" onclick="addAllocation()">Add Funds</button></div></div></div>
<div id="budgetModal" class="modal-overlay"><div class="modal"><h3>Base Budget Manager</h3><p style="color:var(--text-muted); font-size:0.8rem;">Edit the <b>Initial Budget</b> for projects below.</p><div id="budgetManagerList" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div><div style="background:var(--bg-input); padding:10px; border-radius:6px; font-size:0.75rem; color:var(--warning); margin-bottom:15px;"><i class="fa-solid fa-triangle-exclamation"></i> <b>Note:</b> Editing values here modifies the historical "Initial Budget" record. Default source is Navy General Fund. For specific sources, use "+ Funding".</div><div style="text-align:right;"><button class="btn-sync" style="width:auto;" onclick="closeModal('budgetModal')">Done</button></div></div></div>

<div id="invModal" class="modal-overlay">
    <div class="modal">
        <h3>Log Container</h3>

        <div class="input-grid">
            <input id="invId" class="form-control" placeholder="ID (e.g. 911)">
            
            <div style="display:flex; flex-direction:column; gap:5px;">
                <select id="invIso" class="form-control" style="margin:0;" onchange="toggleCustomIso(this.value)"></select>
                <input id="invIsoCustom" class="form-control" style="margin:0; display:none;" placeholder="Enter Isotope (e.g. Pu-239)">
            </div>
            
            <input id="invDate" type="date" class="form-control" title="Date Measured/Received">
        </div>

        <input id="invDesc" class="form-control" placeholder="Description (e.g. Welding Electrodes, Camera Lenses)">

        <div class="input-grid">
            <input id="invAct" class="form-control" placeholder="Activity (e.g. 10 mCi or Unknown)">
            <input id="invDose" type="text" class="form-control" placeholder="Dose Rate (e.g. 5 or Unknown)">
        </div>

        <div style="margin:10px 0; border:1px solid var(--border); padding:10px; border-radius:6px; background:var(--bg-body);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="invTrackFill" onchange="toggleFillSlider()" style="width:auto; margin:0;">
                    <label for="invTrackFill" style="font-size:0.8rem; color:var(--text-main); font-weight:bold; cursor:pointer;">Track Container Fill Level?</label>
                </div>
                <span id="invFillLabel" style="font-size:0.8rem; font-weight:bold; color:var(--accent); display:none;">0%</span>
            </div>
            
            <div id="invFillContainer" style="display:none; margin-top:10px;">
                <input id="invFill" type="range" min="0" max="100" value="0" style="width:100%" oninput="document.getElementById('invFillLabel').innerText = this.value + '%'">
                <div style="display:flex; justify-content:space-between; font-size:0.6rem; color:var(--text-muted);">
                    <span>Empty</span><span>Full</span>
                </div>
            </div>
        </div>

        <label style="font-size:0.7rem; color:var(--text-muted);">ASSIGN TO PROJECT</label>
        <select id="invProj" class="form-control"></select>
        
        <select id="invStatus" class="form-control">
            <option>Stored</option>
            <option>Staged</option>
            <option>Shipped</option>
        </select>

        <div class="input-grid" style="margin-top:10px;">
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">NSN</label>
                <input id="invNsn" class="form-control" placeholder="National Stock #">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">WEIGHT</label>
                <input id="invWeight" class="form-control" placeholder="e.g. 5 kg">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">VOLUME</label>
                <input id="invVol" class="form-control" placeholder="e.g. 10 cu ft">
            </div>
        </div>

        <div class="input-grid" style="margin-top:10px;">
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">MANUFACTURER</label>
                <input id="invMfr" class="form-control" placeholder="e.g. Hanovia">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">SERIAL / MODEL</label>
                <input id="invSerial" class="form-control" placeholder="e.g. 756793">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">SSDR #</label>
                <input id="invSsdr" class="form-control" placeholder="Sealed Source Registry">
            </div>
        </div>
        
        <div class="input-grid">
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">ITEM LOCATION / BLDG</label>
                <input id="invLoc" class="form-control" placeholder="e.g. Bldg 31604">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">PHYSICAL FORM</label>
                <select id="invPhys" class="form-control">
                    <option value="">-- Select --</option>
                    <option>Solid</option><option>Liquid</option><option>Gas</option>
                    <option>Powder</option><option>Sludge</option><option>Debris</option>
                    <option>Glass</option><option>Other</option>
                </select>
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">QTY</label>
                <input id="invQty" type="number" class="form-control" value="1" placeholder="1">
            </div>
        </div>

        <div style="margin-top:10px;">
            <label style="font-size:0.7rem; color:var(--text-muted)">CHEMICAL CONSTITUENTS (IF MIXED WASTE)</label>
            <input id="invConst" class="form-control" placeholder="e.g. Lead, Mercury, Uranium-UO2...">
        </div>

        <div class="input-grid" style="margin-bottom:15px;">
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">NRC LICENSED?</label>
                <select id="invLic" class="form-control">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">LICENSE #</label>
                <input id="invLicNum" class="form-control" placeholder="If applicable...">
            </div>
            <div>
                <label style="font-size:0.7rem; color:var(--text-muted)">RCRA MIXED?</label>
                <select id="invRcra" class="form-control">
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
            </div>
        </div>

        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
            <button class="btn-sync" 
                    style="width:140px; height:38px; justify-content:center; align-items:center; margin:0;" 
                    onclick="cancelAddInventory()">
                Cancel
            </button>
            
            <button class="btn" 
                    style="width:140px; height:38px; display:flex; justify-content:center; align-items:center; border:1px solid transparent; margin:0;" 
                    onclick="addInventory()">
                Add Item
            </button>
        </div>
    </div>
</div>

<div id="exportModal" class="modal-overlay">
    <div class="modal">
        <h3>Export Data</h3>
        <p style="color:var(--text-muted);">Copy this code.</p>
        <textarea id="exportText" class="form-control" style="height:200px; font-size:0.8rem;"></textarea>
        <div style="text-align:right; margin-top:10px;">
            <button class="btn-sync" style="width:auto;" onclick="closeModal('exportModal')">Close</button>
            <button class="btn" onclick="copyExport()">Copy Text</button>
            <button class="btn" style="background:var(--navy)" onclick="downloadBackup()">Download File</button>
        </div>
    </div>
</div>

<div id="importModal" class="modal-overlay">
    <div class="modal">
        <h3>Import Data</h3>
        <p style="color:var(--text-muted);">Paste data code.</p>
        <textarea id="importText" class="form-control" style="height:200px; font-size:0.8rem;"></textarea>
        <div style="text-align:right; margin-top:10px;">
            <button class="btn-sync" style="width:auto;" onclick="closeModal('importModal')">Cancel</button>
            <button class="btn" onclick="runImport()">Load</button>
        </div>
    </div>
</div>

<div id="exemptModal" class="modal-overlay">
    <div class="modal">
        <h3>Log Exempt Disposal</h3>
        <div class="input-grid">
            <div><label style="font-size:0.7rem; color:var(--text-muted)">LOG ID (Optional)</label><input id="exLogId" class="form-control" placeholder="Auto-generate"></div>
            <div><label style="font-size:0.7rem; color:var(--text-muted)">DATE REC'D</label><input id="exDate" type="date" class="form-control"></div>
        </div>
        <label style="font-size:0.7rem; color:var(--text-muted)">GENERATING COMMAND</label>
        <input id="exCmd" class="form-control" placeholder="Command Name">
        <label style="font-size:0.7rem; color:var(--text-muted)">DESCRIPTION / ITEM</label>
        <input id="exDesc" class="form-control" placeholder="Item Description">
        <div class="input-grid">
            <input id="exQty" class="form-control" placeholder="Qty">
            <input id="exIso" class="form-control" placeholder="Isotope">
            <input id="exAct" class="form-control" placeholder="Activity">
        </div>
        <label style="font-size:0.7rem; color:var(--text-muted)">REGULATORY BASIS</label>
        <select id="exBasis" class="form-control">
            <option>10 CFR § 30.15</option>
            <option>10 CFR § 30.19</option>
            <option>10 CFR § 40.13</option>
            <option>Other</option>
        </select>
        <label style="font-size:0.7rem; color:var(--text-muted)">DISPOSAL PATHWAY</label>
        <select id="exPath" class="form-control">
            <option>E-Waste Recycling</option>
            <option>Scrap Metal</option>
            <option>Municipal Trash</option>
            <option>Transfer</option>
        </select>
        <div class="input-grid">
            <div><label style="font-size:0.7rem; color:var(--text-muted)">REVIEWER</label><input id="exRev" class="form-control" placeholder="Initials"></div>
            <div><label style="font-size:0.7rem; color:var(--text-muted)">AUTH DATE</label><input id="exAuthDate" type="date" class="form-control"></div>
        </div>
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn-sync" style="width:auto;" onclick="closeModal('exemptModal')">Cancel</button>
            <button class="btn" onclick="addExemptEntry()">Save Entry</button>
        </div>
    </div>
</div>

<div id="customAlertOverlay" class="custom-modal-overlay">
    <div class="custom-modal-box">
        <div class="cm-head" id="cmHead"><i class="fa-solid fa-circle-exclamation"></i> <span>Alert</span></div>
        <div class="cm-body" id="cmBody">Message goes here...</div>
        <div class="cm-foot" id="cmFoot">
            </div>
    </div>
</div>

<div id="guideModal" class="modal-overlay">
    <div class="modal" style="max-width:1000px; height:95vh; display:flex; flex-direction:column; padding:0; overflow:hidden;">
        
        <div style="background:var(--bg-sidebar); border-bottom:1px solid var(--border); padding:20px; display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:50px; height:50px; background:var(--accent); color:white; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.8rem; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
                    <i class="fa-solid fa-book-atlas"></i>
                </div>
                <div>
                    <h2 style="margin:0; font-size:1.6rem; letter-spacing:-0.5px;">RadFlow Operational Manual</h2>
                    <div style="display:flex; gap:15px; font-size:0.8rem; color:var(--text-muted); margin-top:5px;">
                        <span><i class="fa-solid fa-code-branch"></i> v25.7 Platinum</span>
                        <span><i class="fa-solid fa-shield-halved"></i> For Official Use Only</span>
                        <span><i class="fa-solid fa-server"></i> Local Storage Mode</span>
                    </div>
                </div>
            </div>
            <button class="btn-sync" style="width:auto; height:40px;" onclick="closeModal('guideModal')"><i class="fa-solid fa-xmark"></i> Close Guide</button>
        </div>

        <div style="display:flex; flex:1; overflow:hidden;">
            
            <div style="width:240px; background:var(--bg-input); border-right:1px solid var(--border); overflow-y:auto; padding:15px; display:none; flex-direction:column; gap:8px;" id="guide-toc">
                <style> @media(min-width:800px) { #guide-toc { display:flex !important; } } </style>
                <div style="font-weight:bold; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase; margin-bottom:5px; margin-top:10px;">Navigation</div>
                
                <a href="#g-1" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">1. Critical Protocols</a>
                <a href="#g-2" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">2. Command Center</a>
                <a href="#g-3" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">3. Project Lifecycle</a>
                <a href="#g-4" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">4. Financial Ops</a>
                <a href="#g-5" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">5. HP & Inventory</a>
                <a href="#g-6" class="btn-rect" style="text-align:left; justify-content:flex-start; border:none; background:transparent; font-size:0.9rem;">6. Administration</a>
            </div>

            <div style="flex:1; overflow-y:auto; padding:30px; scroll-behavior:smooth;">
                
                <div id="g-1" style="margin-bottom:40px;">
                    <h3 style="color:var(--danger); border-bottom:2px solid var(--border); padding-bottom:10px; margin-top:0;">
                        <span style="background:var(--danger); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 1</span>
                        Critical Data Protocols
                    </h3>
                    
                    <div style="background:var(--bg-card); border-left:4px solid var(--danger); padding:20px; border-radius:0 4px 4px 0; margin-bottom:20px;">
                        <h4 style="margin-top:0; color:var(--danger);"><i class="fa-solid fa-database"></i> The "Zero-Cloud" Architecture</h4>
                        <p style="font-size:0.9rem;">
                            RadFlow operates entirely in your browser's memory. <b>IT DOES NOT SAVE TO A SERVER.</b>
                            <br>If you clear your cache, re-image your machine, or switch browsers, your data will be gone unless you have a backup.
                        </p>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div style="border:1px solid var(--border); padding:15px; border-radius:8px;">
                            <h4 style="margin-top:0;"><i class="fa-solid fa-file-export"></i> Backup Procedure (SOP-01)</h4>
                            <ol style="font-size:0.9rem; padding-left:20px;">
                                <li>Click <b>Settings</b> or the <b>Export</b> button in the sidebar.</li>
                                <li>Click <b>"Download File"</b>.</li>
                                <li>Save the <code>.json</code> file to a secure, backed-up network location (e.g., S: Drive or OneDrive).</li>
                                <li><b>Frequency:</b> Every Friday at 1500 or after major data entry.</li>
                            </ol>
                        </div>
                        <div style="border:1px solid var(--border); padding:15px; border-radius:8px;">
                            <h4 style="margin-top:0;"><i class="fa-solid fa-file-import"></i> Restoration Procedure</h4>
                            <ol style="font-size:0.9rem; padding-left:20px;">
                                <li>Click <b>Import Data</b> in the sidebar.</li>
                                <li>Open your saved <code>.json</code> file in Notepad.</li>
                                <li>Copy the <b>entire text</b> (Ctrl+A, Ctrl+C).</li>
                                <li>Paste into the Import box and click <b>Load</b>.</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div id="g-2" style="margin-bottom:40px;">
                    <h3 style="color:var(--accent); border-bottom:2px solid var(--border); padding-bottom:10px;">
                        <span style="background:var(--accent); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 2</span>
                        The Command Center
                    </h3>
                    <p style="font-size:0.9rem;">The Dashboard is your morning brief. It aggregates data from all modules.</p>
                    
                    <ul style="font-size:0.9rem; line-height:1.8;">
                        <li><b>Operational Analytics:</b> Two charts showing Project Status (Pie) and Budget Utilization (Bar). If the budget bar is full, you are out of money.</li>
                        <li><b>Active Projects Widget:</b>
                            <ul>
                                <li><i>Sorting:</i> Use the dropdown to sort by <b>Health</b> (Red first) or <b>Status</b>.</li>
                                <li><i>Quick Actions:</i> Hover over a project row to reveal the <i class="fa-solid fa-check"></i> (Task) and <i class="fa-solid fa-dollar-sign"></i> (Expense) shortcuts.</li>
                            </ul>
                        </li>
                        <li><b>Pending Actions:</b> Shows tasks across all projects. Use the sort menu to prioritize <b>"Highest Prio"</b> tasks first.</li>
                        <li><b>Financial Snapshot:</b> A high-level view of Total Budget vs. Total Spent across the entire program.</li>
                    </ul>
                </div>

                <div id="g-3" style="margin-bottom:40px;">
                    <h3 style="color:var(--text-main); border-bottom:2px solid var(--border); padding-bottom:10px;">
                        <span style="background:var(--text-muted); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 3</span>
                        Project Lifecycle Management
                    </h3>
                    
                    <div style="margin-bottom:20px;">
                        <h4 style="border-bottom:1px solid var(--border);">1. Creating & Setting Up</h4>
                        <p style="font-size:0.9rem;">
                            Click <span class="tag">+ Project</span>. Essential fields include <b>UIC</b> (Who owns it), <b>MIPR</b> (Funding document), and <b>Due Date</b>. 
                            <br><i>Tip:</i> You can set an "Initial Budget" here, which creates your first Allocation record automatically.
                        </p>
                    </div>

                    <div style="margin-bottom:20px;">
                        <h4 style="border-bottom:1px solid var(--border);">2. The Detail View</h4>
                        <table class="sci-table" style="font-size:0.85rem;">
                            <tr><td style="width:150px; font-weight:bold;">Health Stoplight</td><td>Manually set this to Green/Yellow/Red. This is your signal to leadership about risk.</td></tr>
                            <tr><td style="font-weight:bold;">Logistics</td><td>Track Contractor, Contract Status (Pre-Prop vs On Contract), and JMC IDs.</td></tr>
                            <tr><td style="font-weight:bold;">Updates Sent</td><td>Use the "Add" button next to Updates Sent to log when you sent a status report. Keeps a history.</td></tr>
                            <tr><td style="font-weight:bold;">Digital Binder</td><td>Paste links to local files (e.g., <code>S:\Projects\2025\Plan.pdf</code>). The system formats them as clickable links.</td></tr>
                        </table>
                    </div>

                    <div style="background:var(--bg-input); padding:15px; border-radius:6px; font-size:0.9rem;">
                        <b><i class="fa-solid fa-clone"></i> Workflow: Cloning a Project</b>
                        <br>For recurring work (e.g., "Quarterly Source Inventory"):
                        1. Open the previous completed project.
                        2. Click <b>Clone</b>.
                        3. The system copies the Title, Desc, and Tasks.
                        4. It <b>resets</b> the financial data and dates to ensure a clean slate.
                    </div>
                </div>

                <div id="g-4" style="margin-bottom:40px;">
                    <h3 style="color:var(--money); border-bottom:2px solid var(--border); padding-bottom:10px;">
                        <span style="background:var(--money); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 4</span>
                        Financial Operations
                    </h3>
                    
                    <p style="font-size:0.9rem;">The Finance module is built on the <b>Bucket Principle</b>: Money flows IN (Allocations) and OUT (Expenses).</p>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                        <div>
                            <h4 style="color:var(--navy);">Money In (Allocations)</h4>
                            <ul style="font-size:0.9rem;">
                                <li><b>Base Budget:</b> The initial funding. Edited via the "Total Budget" card.</li>
                                <li><b>Adjustments:</b> Use <span class="tag">+ Funding</span> to add "Top-ups" or specific command funding.</li>
                                <li><b>Sources:</b> You can track "Navy General Fund" vs "Command Funded" separately.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color:var(--danger);">Money Out (Expenses)</h4>
                            <ul style="font-size:0.9rem;">
                                <li><b>Encumbered:</b> Money reserved (e.g., PR submitted). Counts as "Spent".</li>
                                <li><b>Invoiced/Paid:</b> Finalized costs.</li>
                                <li><b>Estimate:</b> Draft costs. <u>Does not</u> count against the budget.</li>
                            </ul>
                        </div>
                    </div>

                    <div style="border:1px solid var(--accent); border-radius:8px; overflow:hidden;">
                        <div style="background:var(--accent); color:white; padding:10px 15px; font-weight:bold;">
                            <i class="fa-solid fa-calculator"></i> The Estimator Workflow
                        </div>
                        <div style="padding:15px; font-size:0.9rem;">
                            The <b>Est.</b> tab allows you to build detailed Independent Government Estimates (IGEs).
                            <br><br>
                            <b>Step 1:</b> Select Project & Funding Source.<br>
                            <b>Step 2:</b> Add line items (Labor, Disposal, Transport). Rates are pre-loaded.<br>
                            <b>Step 3:</b> Choose your save method:
                            <ul style="margin-bottom:0;">
                                <li><span class="tag" style="background:var(--money); color:white">As Funding</span> &rarr; Increases Project Budget.</li>
                                <li><span class="tag" style="background:var(--danger); color:white">As Cost</span> &rarr; Enters as an "Encumbered" Expense.</li>
                                <li><span class="tag" style="background:var(--text-muted); color:white">As Estimate</span> &rarr; Saves as a Draft (Reference only).</li>
                            </ul>
                            <br>
                            <b>Pro Tip:</b> If an expense has an attached estimate, a <i class="fa-solid fa-file-invoice"></i> icon will appear in the expense table. Click it to view or edit the breakdown.
                        </div>
                    </div>
                </div>

                <div id="g-5" style="margin-bottom:40px;">
                    <h3 style="color:var(--rad); border-bottom:2px solid var(--border); padding-bottom:10px;">
                        <span style="background:var(--rad); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 5</span>
                        Radiation Safety Operations
                    </h3>

                    <h4 style="border-bottom:1px solid var(--border);">1. Inventory Management</h4>
                    <p style="font-size:0.9rem;">
                        Track sources and waste. 
                        <br><b>Decay Correction:</b> Clicking <span class="tag"><i class="fa-solid fa-clock-rotate-left"></i> Decay Correct</span> automatically updates the activity of all known isotopes (Co-60, Cs-137, etc.) based on the date difference.
                        <br><b>Container Fill:</b> Use the slider to track waste drum capacity (0-100%).
                    </p>

                    <h4 style="border-bottom:1px solid var(--border); margin-top:20px;">2. HP Tools Methodology</h4>
                    <table class="sci-table" style="font-size:0.85rem;">
                        <thead><tr><th>Tool</th><th>Formula</th><th>Notes</th></tr></thead>
                        <tbody>
                            <tr>
                                <td><b>Decay</b></td>
                                <td><pre style="margin:0; font-family:monospace; background:transparent; padding:0; border:none;">A = A0 * e^(-λt)</pre></td>
                                <td>Calculates remaining activity. Can solve for "Past" or "Future" dates.</td>
                            </tr>
                            <tr>
                                <td><b>Distance</b></td>
                                <td><pre style="margin:0; font-family:monospace; background:transparent; padding:0; border:none;">I1 * (d1)^2 = I2 * (d2)^2</pre></td>
                                <td>Inverse Square Law. Point source assumption. Includes a "Load from Inventory" button to quickly grab source data.</td>
                            </tr>
                            <tr>
                                <td><b>Shielding</b></td>
                                <td><pre style="margin:0; font-family:monospace; background:transparent; padding:0; border:none;">I = I0 * (0.5)^(x/HVL)</pre></td>
                                <td>Linear attenuation. HVL (Half Value Layer) data is stored for Lead, Iron, and Concrete.</td>
                            </tr>
                            <tr>
                                <td><b>Stay Time</b></td>
                                <td><pre style="margin:0; font-family:monospace; background:transparent; padding:0; border:none;">T = Limit / Rate</pre></td>
                                <td>Calculates max time allowed in a field to stay under a dose limit.</td>
                            </tr>
                            <tr>
                                <td><b>ALARA</b></td>
                                <td><pre style="margin:0; font-family:monospace; background:transparent; padding:0; border:none;">D_coll = Rate * Time * Crew</pre></td>
                                <td>Collective Dose planning for job evolutions.</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 style="border-bottom:1px solid var(--border); margin-top:20px;">3. Exempt Log</h4>
                    <p style="font-size:0.9rem;">
                        Used for consumer product disposal (10 CFR 30.15/19).
                        <br>Entries start as <span class="tag" style="background:var(--warning); color:white">Pending</span>. They only become <span class="tag" style="background:var(--accent); color:white">Authorized</span> when you edit the entry and add an "Auth Date" and Reviewer Initials.
                    </p>
                </div>

                <div id="g-6" style="margin-bottom:20px;">
                    <h3 style="color:var(--navy); border-bottom:2px solid var(--border); padding-bottom:10px;">
                        <span style="background:var(--navy); color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem; vertical-align:middle; margin-right:10px;">CH 6</span>
                        System Administration
                    </h3>
                    
                    <ul style="font-size:0.9rem; line-height:1.8;">
                        <li><b>Identity:</b> Go to Settings to change your "User". This affects the name attached to Chat logs and Task Assignments.</li>
                        <li><b>Team List:</b> You can add/remove team members in Settings. (Note: You cannot delete the user you are currently logged in as).</li>
                        <li><b>Theme:</b> Toggle Dark/Light mode in Settings. This preference is saved to your browser.</li>
                        <li><b>Live Editing:</b> Most tables (Expenses, Inventory, Logbook) support "Click-to-Edit". Changes are saved instantly.</li>
                        <li><b>Reset:</b> "Reset to Defaults" loads the example training data. "Clear All" wipes the database clean.</li>
                        <li><b>Graveyard:</b> Deleted projects are archived in the Graveyard (accessible via Settings). You can view their final status or <b>Revive</b> them if deleted by mistake.</li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="invDetailModal" class="modal-overlay">
        <div class="modal" style="max-width:600px;">
            <div class="modal-header" style="position:relative; padding-right:50px; border-bottom:1px solid var(--border); padding-bottom:15px; margin-bottom:15px;">
                <h2 style="margin:0; display:flex; align-items:center; gap:10px;">
                    <i class="fa-solid fa-box-open" style="color:var(--accent);"></i> 
                    <span id="vid_title" style="letter-spacing:-0.5px;">Item Detail</span>
                </h2>
                
                <div onclick="closeModal('invDetailModal')" 
                     style="position:absolute; top:0; right:0; width:32px; height:32px; 
                            background:var(--bg-input); border-radius:6px; 
                            display:flex; align-items:center; justify-content:center; 
                            cursor:pointer; color:var(--text-muted); transition:all 0.2s ease;"
                     onmouseover="this.style.background='var(--danger)'; this.style.color='white'; this.style.transform='scale(1.05)';"
                     onmouseout="this.style.background='var(--bg-input)'; this.style.color='var(--text-muted)'; this.style.transform='scale(1)';"
                     title="Close (Esc)">
                    <i class="fa-solid fa-xmark" style="font-size:1.1rem;"></i>
                </div>
            </div>
            
            <div class="modal-body">
                <div style="background:var(--bg-card); padding:15px; border-radius:8px; border:1px solid var(--border); margin-bottom:20px; text-align:center;">
                    <input id="vid_iso" class="form-control" style="font-size:1.5rem; font-weight:bold; color:var(--rad); text-align:center; margin-bottom:5px;" placeholder="Isotope (e.g. Co-60)" onchange="saveInvDetail()">
                    <input id="vid_act" class="form-control" style="font-size:1.1rem; color:var(--text-main); text-align:center;" placeholder="Activity (e.g. 10 mCi)" onchange="saveInvDetail()">
    
                    <input id="vid_desc" class="form-control" style="margin-top:10px; text-align:center; font-style:italic;" placeholder="Description..." onchange="saveInvDetail()">
                </div>

                <div style="text-align:right; margin-bottom:10px;">
                    <button class="btn" onclick="saveInvDetail(true)">
                        <i class="fa-solid fa-floppy-disk"></i> Save Changes
                    </button>
                </div>

                <div class="input-grid" style="margin-bottom:10px;">
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">ID / SERIAL</label><input id="vid_id" class="form-control" readonly style="background:var(--bg-body); cursor:not-allowed;"></div>
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted)">STATUS</label>
                        <select id="vid_stat" class="form-control" onchange="saveInvDetail()">
                            <option>Stored</option><option>Staged</option><option>Shipped</option>
                        </select>
                    </div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">DOSE (mR/hr)</label><input id="vid_dose" type="number" class="form-control" onchange="saveInvDetail()"></div>
                </div>

                <h4 style="margin:15px 0 5px 0; border-bottom:1px solid var(--border); font-size:0.8rem; color:var(--text-muted);">ORIGIN & LOCATION</h4>
                
                <div class="input-grid" style="margin-bottom:10px;">
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">MANUFACTURER</label><input id="vid_mfr" class="form-control" onchange="saveInvDetail()"></div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">SERIAL #</label><input id="vid_serial" class="form-control" onchange="saveInvDetail()"></div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">SSDR #</label><input id="vid_ssdr" class="form-control" onchange="saveInvDetail()"></div>
                </div>
                
                <div class="input-grid" style="margin-bottom:10px;">
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">LOCATION</label><input id="vid_loc" class="form-control" onchange="saveInvDetail()"></div>
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted)">FORM</label>
                        <select id="vid_phys" class="form-control" onchange="saveInvDetail()">
                            <option value="">--</option>
                            <option>Solid</option><option>Liquid</option><option>Gas</option>
                            <option>Powder</option><option>Sludge</option><option>Debris</option>
                            <option>Glass</option><option>Other</option>
                        </select>
                    </div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">QTY</label><input id="vid_qty" type="number" class="form-control" onchange="saveInvDetail()"></div>

                    <div><label style="font-size:0.7rem; color:var(--text-muted)">FILL %</label><input id="vid_fill" type="number" min="0" max="100" class="form-control" onchange="saveInvDetail()"></div>
                </div>

                <div style="margin-bottom:10px;">
                    <label style="font-size:0.7rem; color:var(--text-muted)">CHEMICAL CONSTITUENTS</label>
                    <input id="vid_const" class="form-control" placeholder="e.g. Lead, solvents..." onchange="saveInvDetail()">
                </div>

                <h4 style="margin:15px 0 5px 0; border-bottom:1px solid var(--border); font-size:0.8rem; color:var(--text-muted);">REGULATORY & SHIPPING</h4>
                <div class="input-grid" style="margin-bottom:10px;">
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">NSN</label><input id="vid_nsn" class="form-control" placeholder="--" onchange="saveInvDetail()"></div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">WEIGHT</label><input id="vid_weight" class="form-control" placeholder="--" onchange="saveInvDetail()"></div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">VOLUME</label><input id="vid_vol" class="form-control" placeholder="--" onchange="saveInvDetail()"></div>
                </div>
                
                <div class="input-grid" style="margin-bottom:20px;">
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted)">NRC LICENSED</label>
                        <select id="vid_lic" class="form-control" onchange="saveInvDetail()"><option value="No">No</option><option value="Yes">Yes</option></select>
                    </div>
                    <div><label style="font-size:0.7rem; color:var(--text-muted)">LICENSE #</label><input id="vid_licNum" class="form-control" placeholder="--" onchange="saveInvDetail()"></div>
                    <div>
                        <label style="font-size:0.7rem; color:var(--text-muted)">RCRA MIXED</label>
                        <select id="vid_rcra" class="form-control" onchange="saveInvDetail()"><option value="No">No</option><option value="Yes">Yes</option></select>
                    </div>
                </div>

                <h3 style="border-bottom:2px solid var(--accent); padding-bottom:5px; margin-bottom:10px;">
                    <i class="fa-solid fa-folder-open"></i> Item Binder
                </h3>
                <div style="background:var(--bg-input); padding:10px; border-radius:6px; margin-bottom:10px;">
                    <div style="display:flex; gap:10px; margin-bottom:5px;">
                        <input id="vid_linkName" class="form-control" style="margin:0; background:var(--bg-panel);" placeholder="File Name">
                        <input id="vid_linkUrl" class="form-control" style="margin:0; background:var(--bg-panel);" placeholder="Path/URL">
                    </div>
                    <button class="btn" style="width:100%" onclick="addInvLink()">+ Add Document to Item</button>
                </div>
                
                <div id="vid_links" style="display:flex; flex-direction:column; gap:8px;"></div>
                
                <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:15px; text-align:center;">
                    <button class="btn" style="background:var(--bg-body); color:var(--danger); border:1px solid var(--danger); width:100%;" 
                            onmouseover="this.style.background='var(--danger)'; this.style.color='white';"
                            onmouseout="this.style.background='var(--bg-body)'; this.style.color='var(--danger)';"
                            onclick="delInventory(currentInvId)">
                        <i class="fa-solid fa-trash"></i> Delete This Item
                    </button>
                </div>
            </div>
                
            </div>
        </div>
    </div>

<script src="script.js"></script>

</body>
</html>
