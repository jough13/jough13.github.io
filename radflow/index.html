<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RadFlow v5.0 | Command Center</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- THEME & VARIABLES --- */
        :root {
            --bg-body: #0f172a;
            --bg-sidebar: #1e293b;
            --bg-panel: #1e293b;
            --bg-card: #334155;
            --bg-input: #020617;
            --border: #475569;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #10b981;
            --accent-dim: rgba(16, 185, 129, 0.15);
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-body: #f8fafc;
            --bg-sidebar: #ffffff;
            --bg-panel: #ffffff;
            --bg-card: #f1f5f9;
            --bg-input: #e2e8f0;
            --border: #cbd5e1;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --accent: #059669;
            --accent-dim: rgba(5, 150, 105, 0.1);
        }

        * { box-sizing: border-box; outline: none; transition: background 0.2s, color 0.2s; }
        body {
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-body); color: var(--text-main);
            display: grid; grid-template-columns: 240px 1fr 300px; /* 3-Column Layout */
            height: 100vh; overflow: hidden;
        }

        /* --- LEFT SIDEBAR (NAV) --- */
        .sidebar {
            background: var(--bg-sidebar); border-right: 1px solid var(--border);
            padding: 1.5rem; display: flex; flex-direction: column; z-index: 10;
        }
        .brand {
            font-size: 1.3rem; font-weight: 800; color: var(--accent);
            display: flex; align-items: center; gap: 10px; margin-bottom: 2rem;
        }
        .nav-item {
            padding: 0.8rem 1rem; margin-bottom: 0.5rem; border-radius: 8px;
            cursor: pointer; color: var(--text-muted); font-weight: 600; font-size: 0.9rem;
            display: flex; align-items: center; gap: 12px;
        }
        .nav-item:hover { background: var(--bg-card); color: var(--text-main); }
        .nav-item.active { background: var(--accent-dim); color: var(--accent); }

        /* --- CENTER WORKSPACE --- */
        .main {
            padding: 2rem; overflow-y: auto; display: flex; flex-direction: column;
            position: relative;
        }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .page-title h1 { margin: 0; font-size: 1.6rem; }

        /* --- RIGHT SIDEBAR (TEAM LOG) --- */
        .chat-panel {
            background: var(--bg-panel); border-left: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .chat-header {
            padding: 1.5rem; border-bottom: 1px solid var(--border); font-weight: 700;
            font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted);
        }
        .chat-feed { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .chat-input-area { padding: 1rem; border-top: 1px solid var(--border); background: var(--bg-sidebar); }
        
        .msg { background: var(--bg-card); padding: 0.8rem; border-radius: 8px; font-size: 0.85rem; position: relative; }
        .msg-meta { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.7rem; color: var(--text-muted); }
        .msg-text { line-height: 1.4; }
        .msg-del { cursor: pointer; color: var(--danger); opacity: 0; transition: opacity 0.2s; }
        .msg:hover .msg-del { opacity: 1; }

        /* --- DASHBOARD WIDGETS --- */
        .dashboard-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;
        }
        .widget {
            background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px;
            padding: 1.5rem; display: flex; flex-direction: column;
        }
        .widget-head {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;
            font-size: 0.9rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase;
        }
        .widget-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.5rem; }
        .list-item {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg-card); padding: 0.8rem; border-radius: 6px; font-size: 0.9rem;
            cursor: pointer; border-left: 3px solid transparent;
        }
        .list-item:hover { border-left-color: var(--accent); transform: translateX(2px); }
        .list-item.urgent { border-left-color: var(--danger); }
        
        .empty-state { text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 1rem; font-style: italic; }

        /* --- CALENDAR --- */
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 1rem;
        }
        .cal-day-header { text-align: center; font-size: 0.7rem; color: var(--text-muted); font-weight: bold; padding: 5px; }
        .cal-day {
            background: var(--bg-card); min-height: 80px; padding: 5px; border-radius: 4px; border: 1px solid var(--border);
            font-size: 0.8rem; position: relative;
        }
        .cal-day.today { border-color: var(--accent); background: var(--accent-dim); }
        .cal-event {
            font-size: 0.7rem; background: var(--info); color: white; padding: 2px 4px; 
            border-radius: 3px; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .cal-event.due { background: var(--danger); }

        /* --- MODALS & UTILS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100;
            background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-panel); padding: 2rem; border-radius: 12px; width: 450px; border: 1px solid var(--border); }
        
        .form-control { width: 100%; padding: 0.7rem; background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); border-radius: 6px; margin-bottom: 1rem; }
        .btn { padding: 0.6rem 1.2rem; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; background: var(--accent); color: white; }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        
        /* VIEW TOGGLING */
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">
        <i class="fa-solid fa-atom"></i> RadFlow v5
    </div>
    
    <div class="nav-item active" onclick="nav('dashboard')"><i class="fa-solid fa-gauge-high"></i> Dashboard</div>
    <div class="nav-item" onclick="nav('projects')"><i class="fa-solid fa-list-check"></i> Active Projects</div>
    <div class="nav-item" onclick="nav('calendar')"><i class="fa-solid fa-calendar-days"></i> Calendar</div>
    <div class="nav-item" onclick="nav('inventory')"><i class="fa-solid fa-boxes-stacked"></i> Inventory</div>
    <div class="nav-item" onclick="nav('regs')"><i class="fa-solid fa-scale-balanced"></i> Regulations</div>

    <div style="margin-top:auto;">
        <div class="nav-item" onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i> Toggle Theme</div>
        <div class="nav-item" style="color: var(--danger);" onclick="resetData()"><i class="fa-solid fa-trash"></i> Reset Data</div>
    </div>
</div>

<div class="main">
    
    <div id="view-dashboard" class="view-section active">
        <div class="header">
            <div class="page-title">
                <h1>Command Center</h1>
                <p id="todayDate">Loading...</p>
            </div>
            <button class="btn" onclick="openModal('projectModal')">+ Quick Project</button>
        </div>

        <div class="dashboard-grid">
            
            <div class="widget">
                <div class="widget-head">
                    <span>Active Projects</span>
                    <span style="font-size:0.8rem; cursor:pointer; color:var(--accent);" onclick="nav('projects')">View All &rarr;</span>
                </div>
                <div id="dash-projects" class="widget-list"></div>
            </div>

            <div class="widget">
                <div class="widget-head">
                    <span>Recent Inventory</span>
                    <span style="font-size:0.8rem; cursor:pointer; color:var(--accent);" onclick="nav('inventory')">View All &rarr;</span>
                </div>
                <div id="dash-inventory" class="widget-list"></div>
            </div>

            <div class="widget">
                <div class="widget-head">
                    <span>Pending Review</span>
                    <i class="fa-solid fa-triangle-exclamation" style="color:var(--warning);"></i>
                </div>
                <div id="dash-reviews" class="widget-list"></div>
            </div>

            <div class="widget">
                <div class="widget-head">External Tools</div>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn btn-ghost" onclick="window.open('https://www.nrc.gov')">NRC.gov</button>
                    <button class="btn btn-ghost" onclick="window.open('https://www.phmsa.dot.gov')">DOT Hazmat</button>
                    <button class="btn btn-ghost" onclick="alert('Simulated Manifest Gen')">eManifest</button>
                </div>
            </div>

        </div>
    </div>

    <div id="view-calendar" class="view-section">
        <div class="header">
            <div class="page-title">
                <h1>Shared Calendar</h1>
                <p>Shipment Windows & Compliance Deadlines</p>
            </div>
            <button class="btn btn-ghost">Sync Outlook</button>
        </div>
        <div class="widget" style="padding: 1rem;">
            <h3 style="text-align:center; margin:0 0 1rem 0;">December 2025</h3>
            <div class="calendar-grid">
                <div class="cal-day-header">SUN</div><div class="cal-day-header">MON</div><div class="cal-day-header">TUE</div><div class="cal-day-header">WED</div><div class="cal-day-header">THU</div><div class="cal-day-header">FRI</div><div class="cal-day-header">SAT</div>
                <div id="cal-days-container" style="display:contents;"></div>
            </div>
        </div>
    </div>

    <div id="view-projects" class="view-section">
        <div class="header"><h1>Active Projects</h1></div>
        <div class="widget">
            <div id="full-project-list" class="widget-list"></div>
        </div>
    </div>

    <div id="view-inventory" class="view-section">
        <div class="header">
            <h1>Inventory</h1>
            <button class="btn" onclick="openModal('invModal')">+ Add Item</button>
        </div>
        <div class="widget">
            <table style="width:100%; text-align:left; border-collapse:collapse; font-size:0.9rem;">
                <thead style="color:var(--text-muted); border-bottom:1px solid var(--border);">
                    <tr><th style="padding:10px;">ID</th><th>Type</th><th>Dose (mR/hr)</th><th>Status</th></tr>
                </thead>
                <tbody id="full-inv-list"></tbody>
            </table>
        </div>
    </div>
    
    <div id="view-regs" class="view-section">
        <div class="header"><h1>Regulations</h1></div>
        <p>Placeholder for Regs Library</p>
    </div>

</div>

<div class="chat-panel">
    <div class="chat-header">
        <i class="fa-regular fa-comments"></i> Team Log
    </div>
    <div id="chatFeed" class="chat-feed">
        </div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" class="form-control" placeholder="Type a note..." onkeypress="handleChat(event)">
        <div style="font-size:0.7rem; color:var(--text-muted); margin-top:5px;">Press Enter to post</div>
    </div>
</div>

<div id="projectModal" class="modal-overlay">
    <div class="modal">
        <h3>New Project</h3>
        <input id="pTitle" class="form-control" placeholder="Project Name">
        <input id="pDate" type="date" class="form-control">
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn btn-ghost" onclick="closeModal('projectModal')">Cancel</button>
            <button class="btn" onclick="addProject()">Save</button>
        </div>
    </div>
</div>

<div id="invModal" class="modal-overlay">
    <div class="modal">
        <h3>New Inventory Item</h3>
        <input id="invId" class="form-control" placeholder="ID (e.g. DRUM-99)">
        <input id="invType" class="form-control" placeholder="Type (e.g. Class A)">
        <input id="invDose" type="number" class="form-control" placeholder="Dose Rate">
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn btn-ghost" onclick="closeModal('invModal')">Cancel</button>
            <button class="btn" onclick="addInventory()">Save</button>
        </div>
    </div>
</div>

<script>
    // --- STATE ---
    let projects = JSON.parse(localStorage.getItem('rad5_projects')) || [
        { id: 1, title: 'Resin Liner A', status: 'Active', due: '2025-12-25' },
        { id: 2, title: 'Annual Report', status: 'Review', due: '2025-12-30' },
        { id: 3, title: 'Lab Decon', status: 'Planning', due: '2026-01-15' }
    ];
    let inventory = JSON.parse(localStorage.getItem('rad5_inv')) || [
        { id: 'D-101', type: 'Drum', dose: 0.5, status: 'Stored' },
        { id: 'B-202', type: 'Box', dose: 1.2, status: 'Staged' }
    ];
    let chatLog = JSON.parse(localStorage.getItem('rad5_chat')) || [
        { id: 1, user: 'JD', text: 'Welcome to RadFlow v5. Check the calendar!', time: '10:00 AM' }
    ];

    // --- RENDERERS ---
    function render() {
        renderDashboard();
        renderCalendar();
        renderChat();
    }

    function renderDashboard() {
        document.getElementById('todayDate').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        
        // 1. Projects Widget
        const pList = document.getElementById('dash-projects');
        pList.innerHTML = '';
        projects.slice(0, 4).forEach(p => {
            const li = document.createElement('li');
            li.className = `list-item ${p.status === 'Review' ? 'urgent' : ''}`;
            li.innerHTML = `<span>${p.title}</span> <span style="font-size:0.75rem; color:var(--text-muted);">${p.status}</span>`;
            li.onclick = () => nav('projects');
            pList.appendChild(li);
        });

        // 2. Reviews Widget
        const rList = document.getElementById('dash-reviews');
        rList.innerHTML = '';
        const reviews = projects.filter(p => p.status === 'Review');
        if(reviews.length === 0) rList.innerHTML = '<div class="empty-state">No pending reviews</div>';
        reviews.forEach(p => {
            const li = document.createElement('li');
            li.className = 'list-item urgent';
            li.innerHTML = `<span>${p.title}</span> <span style="font-size:0.75rem; color:var(--danger);">Action Needed</span>`;
            rList.appendChild(li);
        });

        // 3. Inventory Widget
        const iList = document.getElementById('dash-inventory');
        iList.innerHTML = '';
        inventory.slice(0, 3).forEach(i => {
            const li = document.createElement('li');
            li.className = 'list-item';
            li.innerHTML = `<span>${i.id}</span> <span style="font-size:0.75rem; color:var(--text-muted);">${i.dose} mR/hr</span>`;
            li.onclick = () => nav('inventory');
            iList.appendChild(li);
        });

        // Full Lists
        const fullP = document.getElementById('full-project-list');
        fullP.innerHTML = '';
        projects.forEach(p => {
            fullP.innerHTML += `<div class="list-item"><span>${p.title}</span> <span>Due: ${p.due}</span></div>`;
        });

        const fullI = document.getElementById('full-inv-list');
        fullI.innerHTML = '';
        inventory.forEach(i => {
            fullI.innerHTML += `<tr><td style="padding:10px; border-bottom:1px solid #334155;">${i.id}</td><td style="border-bottom:1px solid #334155;">${i.type}</td><td style="border-bottom:1px solid #334155;">${i.dose}</td><td style="border-bottom:1px solid #334155;">${i.status}</td></tr>`;
        });
    }

    function renderCalendar() {
        const container = document.getElementById('cal-days-container');
        container.innerHTML = '';
        // Mocking a 31 day month starting on Sunday for simplicity in demo
        for(let i=1; i<=31; i++) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'cal-day';
            if(i === new Date().getDate()) dayDiv.classList.add('today');
            dayDiv.innerHTML = `<span style="font-weight:bold; color:var(--text-muted);">${i}</span>`;
            
            // Check for events
            const dayStr = `2025-12-${String(i).padStart(2, '0')}`;
            projects.forEach(p => {
                if(p.due === dayStr) {
                    dayDiv.innerHTML += `<div class="cal-event due" title="${p.title}">Due: ${p.title}</div>`;
                }
            });
            container.appendChild(dayDiv);
        }
    }

    function renderChat() {
        const feed = document.getElementById('chatFeed');
        feed.innerHTML = '';
        chatLog.forEach(c => {
            const msg = document.createElement('div');
            msg.className = 'msg';
            msg.innerHTML = `
                <div class="msg-meta">
                    <span><b>${c.user}</b></span>
                    <span>${c.time} <i class="fa-solid fa-trash msg-del" onclick="delChat(${c.id})"></i></span>
                </div>
                <div class="msg-text">${c.text}</div>
            `;
            feed.appendChild(msg);
        });
        feed.scrollTop = feed.scrollHeight;
    }

    // --- ACTIONS ---
    function handleChat(e) {
        if(e.key === 'Enter') {
            const txt = document.getElementById('chatInput').value;
            if(!txt) return;
            chatLog.push({
                id: Date.now(),
                user: 'Me', // In a real app, use auth
                text: txt,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });
            save();
            document.getElementById('chatInput').value = '';
        }
    }
    
    function delChat(id) {
        chatLog = chatLog.filter(c => c.id !== id);
        save();
    }

    function addProject() {
        const t = document.getElementById('pTitle').value;
        const d = document.getElementById('pDate').value;
        if(t && d) {
            projects.push({ id: Date.now(), title: t, due: d, status: 'Active' });
            save();
            closeModal('projectModal');
        }
    }

    function addInventory() {
        const id = document.getElementById('invId').value;
        const type = document.getElementById('invType').value;
        const dose = document.getElementById('invDose').value;
        if(id) {
            inventory.push({ id, type, dose, status: 'Stored' });
            save();
            closeModal('invModal');
        }
    }

    // --- UTILS ---
    function nav(viewId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        // Highlight active nav logic omitted for brevity in v5
    }

    function save() {
        localStorage.setItem('rad5_projects', JSON.stringify(projects));
        localStorage.setItem('rad5_inv', JSON.stringify(inventory));
        localStorage.setItem('rad5_chat', JSON.stringify(chatLog));
        render();
    }

    function resetData() {
        if(confirm("Reset all data?")) { localStorage.clear(); location.reload(); }
    }
    
    function toggleTheme() {
        const b = document.body;
        const cur = b.getAttribute('data-theme');
        b.setAttribute('data-theme', cur === 'light' ? 'dark' : 'light');
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // Init
    render();

</script>
</body>
</html>
