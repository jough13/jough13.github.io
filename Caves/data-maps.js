window.TILE_DATA = {
    'ğŸš¢': {
        type: 'loot_container', // Reuses the chest logic!
        name: 'Sunken Shipwreck',
        flavor: "You search the rotting hull for salvaged goods...",
        lootTable: ['$', 'ğŸš', 'ğŸ’b', 'âš“', 'ğŸŸ'] 
    },
    'ğŸ§™â€â™‚ï¸': {
        type: 'lore_statue', // Reuses statue logic!
        message: [
            "The hermit's ghost whispers: 'The King didn't find the Void. The Void found him.'",
            "A message is carved into the stone: 'Beware the rain in the deadlands.'"
        ]
    },
    '#': {
        type: 'lore',
        message: 'An ancient, weathered stone stands here. The markings are faded.'
    },
    'â˜—': {
        type: 'lore',
        message: ['"...the king has fallen..."', '"...his castle to the west lies empty..."', '"...but a dark presence still lingers."']
    },
    'â›°': {
        type: 'dungeon_entrance',
        getCaveId: (x, y) => `cave_${x}_${y}`
    },
    '>': {
        type: 'dungeon_exit'
    },
    'ğŸ°': {
        type: 'castle_entrance',
        getCastleId: (x, y) => `castle_${x}_${y}`
    },
    'X': {
        type: 'castle_exit'
    },
    'B': {
        type: 'lore',
        message: 'This is a bounty board, covered in notices.'
    },
    'L': {
        type: 'journal',
        title: 'The King\'s Lament',
        content: `Day 34 since the fall...\n\nThe stones of this castle weep. I hear them every night. The whispers tell of a power that sleeps beneath the mountains, a power we were foolish to awaken.\n\nMy knights are gone. My kingdom is ash. All that remains is this cursed immortality, a silent witness to my failure.`
    },
    'N': {
        type: 'npc',
        title: 'Villager'
    },
    'Â§': {
        type: 'shop',
        title: 'General Store'
    },
    'H': {
        type: 'npc_healer',
        title: 'Healer'
    },
    'W': {
        type: 'workbench',
        title: 'Crafting Workbench'
    },
    'G': {
        type: 'npc_guard',
        title: 'Castle Guard'
    },
    'O': {
        type: 'npc_sage',
        title: 'Sage'
    },
    'T': {
        type: 'npc_skill_trainer',
        title: 'Skill Trainer'
    },
    'J': {
        type: 'journal',
        title: 'Orc War-Chant',
        content: `Blood and dust. Steel and bone.\n\nThe weak build with stone. The strong build with fear.\n\nWe come from the fire, we return to the ash. The mountain is our mother, the world our feast. Stomp the soft-skins. Take their steel. Raise the tusk-banner.\n\n...the rest is scrawled in a crude, unintelligible script.`
    },
    'ğŸ“˜': {
        type: 'journal',
        title: 'Frozen Journal',
        content: `Day 12: The cold... it seeps into your bones. But the essence in these walls is worth a fortune. I must have more.\n\nDay 15: I saw one of them today. A... walking corpse, encased in ice. It didn't see me. My pickaxe feels heavy.\n\nDay 17: They are the old ones. The first warriors. The cold preserves them. Binds them. They guard the essence.\n\nDay ???: Can't feel my fingers. It's in my pack. I can't... I...`
    },
    'K': {
        type: 'npc_prospector',
        title: 'Lost Prospector'
    },
    'c': {
        type: 'canoe',
        title: 'A small canoe'
    },
    'â™›': {
        type: 'landmark_castle',
        getCastleId: (x, y) => `castle_landmark_${x}_${y}`
    },
    'b': {
        type: 'enemy'
    },
    'w': {
        type: 'enemy'
    },
    'V': {
        type: 'village_entrance',
        getVillageId: (x, y) => `village_${x}_${y}`
    },
    'â›©ï¸': {
        type: 'shrine'
    },
    'ğŸ“': {
        type: 'npc_historian',
        title: 'Royal Historian'
    },
    '|': {
        type: 'obelisk'
    },
    'Â¥': {
        type: 'trader'
    },
    'ğŸ“¦': {
        type: 'loot_chest'
    },
    'ğŸ”¥': {
        type: 'cooking_fire',
        flavor: "A crackling fire. Good for cooking."
    },
    'Î©': {
        type: 'dungeon_entrance',
        getCaveId: (x, y) => `void_${x}_${y}`, // Creates a unique ID starting with "void_"
        flavor: "The reality tears open here. You hear whispers from the other side."
    },
    'âˆ´': {
        type: 'dig_spot',
        name: 'Loose Soil',
        flavor: "The earth here looks disturbed recently..."
    },
    'T': {
        type: 'decoration', // Dead Tree
    },
    'âš°ï¸': {
        type: 'loot_container', // We'll treat this like a chest, but with specific flavor
        name: 'Ancient Grave',
        flavor: "You disturb the resting place of a forgotten warrior...",
        lootTable: ['(', '(', 'â€ ', 'ğŸ‘¢', 'ğŸ›¡ï¸', 'ğŸ’€'] // Bones, Daggers, Boots, Shields
    },
    'ğŸ—¿': {
        type: 'lore_statue',
        message: [
            "The statue's face is worn away, but it still holds a bowl of fresh water.",
            "A statue of a weeping knight. The inscription reads: 'Duty is heavier than a mountain.'",
            "A crude idol made of mud and sticks. It smells of goblin musk.",
            "A statue of a woman holding a lantern. You feel safer standing near it.",
            "A headless statue pointing toward the eastern mountains.",
            "A statue of a dog. Someone has left a Fossilized Bone at its feet."
        ]
    },
    'ğŸº': {
        type: 'loot_container',
        name: 'Dusty Urn',
        flavor: "You smash the urn open...",
        lootTable: ['$', '$', 'gold_dust', 'ancient_coin', 'ğŸ’']
    },
    'ğŸ•³ï¸': {
        type: 'landmark_cave', // New type
        getCaveId: (x, y) => `cave_landmark`, // Fixed ID so it's always the same dungeon
        flavor: "A gaping abyss stares back at you. Cold air rushes up from the depths."
    },
    'â›º': {
        type: 'campsite',
        flavor: "An abandoned campsite. The embers are still warm."
    },
    'ğŸ›ï¸': {
        type: 'ruin',
        flavor: "The crumbling remains of an ancient library."
    },
    'ğŸŒ¿': {
        type: 'forage',
        item: 'Medicinal Herb'
    },
    'ğŸ•¸': {
        type: 'obstacle',
        name: 'Spider Web',
        tool: 'Machete',
        spell: 'fireball', // Fireball can burn it
        flavor: "A thick, sticky web blocks the path."
    },
    'ğŸ›¢': {
        type: 'barrel',
        name: 'Oil Barrel',
        flavor: "Filled with volatile oil. Highly flammable."
    },
    'ğŸš': {
        type: 'obstacle',
        name: 'Cracked Wall',
        tool: 'Pickaxe',
        flavor: "The stone looks fractured and weak."
    },
    'ğŸŒ³': {
        type: 'obstacle',
        name: 'Thicket',
        tool: 'Machete',
        flavor: "A dense wall of thorny vines."
    },
    'ğŸŒ³e': {
        type: 'anomaly',
        name: 'Elder Tree',
        flavor: "A massive tree with silver bark. It hums with life."
    },
    'ğŸ—¿k': {
        type: 'anomaly',
        name: 'Petrified Giant',
        flavor: "A boulder shaped like a weeping giant. Moss covers its eyes."
    },
    'ğŸ¦´d': { // Reusing bone icon for map tile
        type: 'anomaly',
        name: 'Dragon Skeleton',
        flavor: "The bleached ribs of a colossal beast rise from the sand."
    },
};

window.CASTLE_LAYOUTS = {
    LIBRARY_WING: {
        spawn: { x: 11, y: 11 }, // <--- CHANGED from {x:10, y:15} to match the Exit (X) location
        map: [
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“.........B.........â–“',
            'â–“.â–“â–“â–“.â–“â–“â–“...â–“â–“â–“.â–“â–“â–“.â–“',
            'â–“.â–“Lâ–“.â–“Lâ–“.O.â–“Lâ–“.â–“Lâ–“.â–“', 
            'â–“.â–“â–“â–“.â–“â–“â–“...â–“â–“â–“.â–“â–“â–“.â–“',
            'â–“...................â–“',
            'â–“.â–“â–“â–“.â–“â–“â–“...â–“â–“â–“.â–“â–“â–“.â–“',
            'â–“.â–“Lâ–“.â–“Lâ–“.ğŸ“.â–“Lâ–“.â–“Lâ–“.â–“', 
            'â–“.â–“â–“â–“.â–“â–“â–“...â–“â–“â–“.â–“â–“â–“.â–“',
            'â–“.........W.........â–“', 
            'â–“...................â–“',
            'â–“...â–“â–“â–“â–“â–“â–“.X.â–“â–“â–“â–“â–“â–“.â–“', // The X is at x:11, y:11
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“'
        ]
    },
    COURTYARD: {
        spawn: {
            x: 37,
            y: 32
        }, // Your original spawn point
        map: [
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“...................................................................â–“',
            'â–“...................................B...................................â–“',
            'â–“.....â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“.....â–“',
            'â–“.....â–“.....................â–“.......â–“.....................â–“.....â–“',
            'â–“.....â–“.....................â–“.......â–“.....................â–“.....â–“',
            'â–“.....â–“.....................â–“.......â–“...â–“â–“â–“...â–“â–“â–“...â–“â–“â–“...â–“.....â–“',
            'â–“.....â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“.......â–“...â–“.â–“...â–“.â–“...â–“.â–“...â–“.....â–“',
            'â–“...................................â–“...â–“â–“â–“...â–“â–“â–“...â–“â–“â–“...â–“.....â–“',
            'â–“...................................â–“.....................â–“.....â–“',
            'â–“...................................â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“.....â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“....â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“.......................................â–“',
            'â–“....â–“...................â–“..........................................â–“',
            'â–“....â–“...â–“â–“â–“...â–“â–“â–“...â–“...â–“..........................................â–“',
            'â–“....â–“...â–“.â–“...â–“.â–“...â–“...â–“..........................................â–“',
            'â–“....â–“...â–“â–“â–“...â–“â–“â–“...â–“...â–“..........................................â–“',
            'â–“....â–“...................â–“..........................................â–“',
            'â–“....â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“..........................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“...................................................................â–“',
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“Xâ–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“', // Exit
        ]
    },

    TOWER: {
        spawn: { x: 10, y: 18 },
        map: [
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“...................â–“',
            'â–“...â–“â–“â–“.............â–“',
            'â–“...â–“.â–“...â–“â–“â–“.......â–“',
            'â–“...â–“.â–“...â–“.â–“.......â–“',
            'â–“...â–“â–“â–“...â–“â–“â–“.......â–“',
            'â–“...................â–“',
            'â–“.........â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“.........â–“.........â–“',
            'â–“.........â–“........â–“', // Note: This row in your original was also missing a space at the end
            'â–“.........â–“.........â–“',
            'â–“.........â–“...L.....â–“',
            'â–“.........â–“.........â–“',
            'â–“...â–“â–“â–“...â–“â–“â–“.......â–“',
            'â–“...â–“.O.â–“.......â–“...â–“', // Fixed width
            'â–“...â–“.ğŸ“„.â–“.......â–“...â–“', // Fixed width
            'â–“...â–“â–“â–“...â–“.......â–“...â–“', // Fixed width
            'â–“.............â–“.....â–“',
            'â–“.............X.....â–“',
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“Tâ–“â–“â–“â–“â–“â–“â–“â–“â–“'
        ]
    },

    FORTRESS: {
        spawn: {
            x: 4,
            y: 38
        }, // Spawns near the gate
        map: [
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“...............................................................................â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“.........................................â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“......â–“...â–“...â–“...â–“......â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“......â–“...â–“...â–“...â–“......â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“.........................................â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...................................................â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“',
            'â–“...â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...............................................................................â–“',
            'â–“...............................................................................â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“',
            'â–“...â–“...B...â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“...$.....â–“...â–“...$.....â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“.......â–“...â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...............................................................................â–“',
            'â–“...............T.....................................................G.........â–“',
            'â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“....X..........................................................................â–“', // Exit is here
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...............â–“$â–“...............â–“',
            'â–“....W..........â–“$â–“....W..........â–“',
            'â–“...............â–“$â–“...............â–“',
            'â–“...............â–“â–“â–“...............â–“',
            'â–“.................................â–“',
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“', // Bottom of the fortress
        ]
    },
    GRAND_FORTRESS: {
        spawn: {
            x: 4,
            y: 38
        }, // Same spawn as Fortress
        map: [
            // This is a copy of FORTRESS, with two new rooms added
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“',
            'â–“...............................................................................â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“.........................................â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“......â–“...â–“...â–“...â–“......â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“......â–“...â–“...â–“...â–“......â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“.........................................â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“...................................................â–“...â–“...â–“',
            'â–“...â–“...â–“..........â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“',
            'â–“...â–“...â–“.......................................................................â–“...â–“',
            'â–“...â–“...â–“..................â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“.......................â–“...â–“',
            'â–“...â–“...â–“..................â–“.........B.........â–“.......â–“.......................â–“...â–“',
            'â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“...â–“.........â–“...L...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“.......â–“.......â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“â–“â–“...â–“.......â–“..O....â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“.......â–“.......â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“...â–“.....j.â–“...â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“...â–“...ğŸ’ª....â–“...â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“...â–“.......â–“...â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“.............â–“...â–“.........â–“...â–“.â–“...â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“.........â–“...â–“.........â–“...â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“...............................................................................â–“',
            'â–“.......................â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...............................â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“.......$.......â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“...$...$...$...â–“...â–“.......â–“...â–“.......â–“...â–“...â–“',
            'â–“...â–“...B...â–“...â–“.......â–“...â–“...$...B...$...â–“...â–“.......â–“...â–“.......â–“...â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“...$...$...$...â–“...â–“.......â–“...â–“.......â–“...â–“...â–“',
            'â–“...â–“.......â–“...â–“.......â–“...â–“.......$.......â–“...â–“.......â–“...â–“.......â–“...â–“...â–“',
            'â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“...â–“',
            'â–“................................G...G..........................................â–“',
            'â–“...............................................................................â–“',
            'â–“â–“â–“â–“...â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“.â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',
            'â–“....X..........................................................................â–“', // Exit is here
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“...â–“',

            'â–“...............â–“$â–“...............â–“',
            'â–“...............â–“$â–“...............â–“',
            'â–“...............â–“$â–“...............â–“',
            'â–“...............â–“â–“â–“...............â–“',
            'â–“.................................â–“',
            'â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“', // Bottom of the fortress
        ]

    },

    SAFE_HAVEN: {
        spawn: { x: 15, y: 26 },
        map: [
            'F F F F F F F F F F F F F F F F F F F F F F F F F F F F F F',
            'F F F F F F F F F F F F F F F F F F F F F F F F F F F F F F',
            'F F ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§± F F F F F F F F F F F F F ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§± F F',
            'F F ğŸ§±.....ğŸ§± F F F F F F F F F F F F F ğŸ§±.....ğŸ§± F F',
            'F F ğŸ§±..H..ğŸ§± F F F F F F F F F F F F F ğŸ§±..Â§..ğŸ§± F F',
            'F F ğŸ§±.....ğŸ§± F F F F F F F F F F F F F ğŸ§±.....ğŸ§± F F',
            'F F ğŸ§±ğŸ§±+ğŸ§±ğŸ§± F F F F F F F F F F F F F ğŸ§±ğŸ§±+ğŸ§±ğŸ§± F F',
            'F F F ... F F F F F F F F F F F F F F F F ... F F F',
            'F F F ... F F F F F F F F F F F F F F F F ... F F F',
            'F F F ... F F F ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§± F F F F F ... F F F',
            'F F F ... F F F ğŸ§±...........ğŸ§± F F F F F ... F F F',
            'F F F ... F F F ğŸ§±...ğŸ”¥.B...ğŸ§± F F F F F ... F F F',
            'F F F ... F F F ğŸ§±...........ğŸ§± F F F F F ... F F F',
            'F F F ... F F F ğŸ§±.....ğŸ“.....ğŸ§± F F F F F ... F F F',
            'F F F ... F F F ğŸ§±ğŸ§±ğŸ§±...ğŸ§±ğŸ§±ğŸ§± F F F F F ... F F F',
            'F F F ... F F F F F F ... F F F F F F F F ... F F F',
            'F F F ... F F F F F F ... F F F F F F F F ... F F F',
            'F F ğŸ§±ğŸ§±+ğŸ§±ğŸ§± F F F F ... F F F F F F F ğŸ§±ğŸ§±+ğŸ§±ğŸ§± F F',
            'F F ğŸ§±.....ğŸ§± F F F F ... F F F F F F F ğŸ§±.....ğŸ§± F F',
            'F F ğŸ§±..R..ğŸ§± F F F F ... F F F F F F F ğŸ§±..T..ğŸ§± F F',
            'F F ğŸ§±.....ğŸ§± F F F F ... F F F F F F F ğŸ§±.....ğŸ§± F F',
            'F F ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§± F F F F ... F F F F F F F ğŸ§±ğŸ§±ğŸ§±ğŸ§±ğŸ§± F F',
            'F F F F F F F F F F F ... F F F F F F F F F F F F F F',
            'F F F F F F F F F F F ... F F F F F F F F F F F F F F',
            'F F F F F F F F F F F ... F F F F F F F F F F F F F F',
            'F F F F F F F F F F F ... F F F F F F F F F F F F F F',
            'F F F F F F F F F F F .X. F F F F F F F F F F F F F F', // Exit
            'F F F F F F F F F F F F F F F F F F F F F F F F F F F',
        ]
    },

};

window.CAVE_THEMES = {
    FUNGAL: {
        name: 'The Mycelium Depths',
        wall: 'â–“',
        floor: '.',
        secretWall: 'â–’',
        colors: {
            wall: '#4a1d96', // Deep Purple
            floor: '#7e22ce' // Bright Purple
        },
        decorations: ['ğŸ„', 'ğŸ„', 'ğŸŒ¿', 'ğŸº', 'S'], // Heavy mushroom spawns
        enemies: ['@', 'l', 's'] // Spiders, Leeches, Skeletons
    },
    GOLDEN: {
        name: 'The Glimmering Vault',
        wall: 'ğŸ§±',
        floor: '.',
        secretWall: 'â–’',
        colors: {
            wall: '#ca8a04', // Dark Gold/Bronze
            floor: '#facc15' // Gold
        },
        decorations: ['$', '$', 'ğŸº', 'ğŸ‘‘', 'ğŸ“¦'], // High gold spawns
        enemies: ['m', 'o', 'C'] // Mages, Orcs, and Bandit Chiefs
    },
    CORRUPTED: {
        name: 'The Abyssal Tear',
        wall: 'â–“',
        floor: '.',
        phaseWall: 'â–’',
        colors: {
            wall: '#000000', 
            floor: '#1e1b4b' // Deep Midnight Blue
        },
        decorations: ['âœ¨', 'ğŸ’€', 'vd', 'Î©'],
        enemies: ['v', 'D', 'a'] // Void Stalkers, Demons, Acolytes
    },
    ROCK: {
        name: 'A Dark Cave',
        wall: 'â–“',
        floor: '.',
        secretWall: 'â–’',
        colors: {
            wall: '#422006',
            floor: '#a16207'
        },
        decorations: ['+', 'ğŸ”®', '$', 'ğŸ“–', 'K', 'ğŸš'],
        enemies: ['g', 's', '@']
    },
    ICE: {
        name: 'A Glacial Cavern',
        wall: 'â–’', 
        secretWall: 'â–“',
        floor: '.', // FIX: Changed from ':' to '.' to prevent Wildberry conflict
        colors: {
            wall: '#99f6e4',
            floor: '#e0f2fe' // This color makes it look like ice
        },
        enemies: ['s', 'w', 'Z', 'Y']
    },
    FIRE: {
        name: 'A Volcanic Fissure',
        wall: 'â–“',
        secretWall: 'â–’',
        floor: '.', 
        colors: {
            wall: '#450a0a',
            floor: '#ef4444' 
        },
        decorations: ['+', '$', 'ğŸ”¥', 'J'],
        enemies: ['b', 'C', 'o', 'm', 'ğŸ‘º', 'f']
    },
    CRYPT: {
        name: 'A Musty Crypt',
        wall: 'â–“', 
        floor: '.', 
        secretWall: 'â–’',
        colors: {
            wall: '#374151', 
            floor: '#4b5563' 
        },
        decorations: ['+', '$', '(', 'â€ ', 'ğŸŒ€', 'ğŸ˜±', 'ğŸ’€', 'ğŸ•¸'],
        enemies: ['s', 'Z', 'a']
    },
    CRYSTAL: {
        name: 'A Crystalline Tunnel',
        wall: 'â–’', 
        secretWall: 'â–“',
        floor: '.',
        colors: {
            wall: '#67e8f9', 
            floor: '#22d3ee' 
        },
        decorations: ['Y', 'ğŸ”®', '$', 'K'],
        enemies: ['g']
    },
    VOID: {
        name: 'The Void Sanctum',
        wall: 'â–“',         
        floor: '.',        
        phaseWall: 'â–’',    
        colors: {
            wall: '#2e0249', 
            floor: '#0f0518' 
        },
        decorations: ['âœ¨', 'ğŸ’€', 'Î©'],
        enemies: ['v', 'a', 'm', 'v', 'D']
    },
    ABYSS: {
        name: 'The Maw',
        wall: 'â–“',
        floor: '.',
        secretWall: 'â–’',
        colors: {
            wall: '#0f0f0f', 
            floor: '#331133' 
        },
        decorations: ['ğŸ’€', 'ğŸ•¸ï¸', 'ğŸ”¥', 'Î©', 'ğŸ’', 'ğŸ•¸'],
        enemies: ['o', 'm', 'Z', 'g', 'ğŸº', 'ğŸ¦‚', 'a'] 
    },
    SUNKEN: {
        name: 'The Sunken Temple',
        wall: 'ğŸ§±',
        floor: '.', 
        secretWall: 'â–’',
        colors: {
            wall: '#0e7490', 
            floor: '#1e3a8a'  
        },
        decorations: ['ğŸŸ', 'ğŸŒ¿', 'ğŸ—¿', 'ğŸ¦€'],
        enemies: ['ğŸ¸', 'ğŸ', 'l', 'ğŸ¦‘']
    },
    GROTTO: {
        name: 'A Sunken Grotto',
        wall: 'â–“', 
        floor: '.', // Changed from ':' to '.'
        secretWall: 'â–’',
        colors: {
            wall: '#14532d', 
            floor: '#16a34a' 
        },
        decorations: ['+', 'S', 'ğŸ”®', 'â˜£ï¸', 'ğŸ•¸'],
        enemies: ['g', 'w', '@']
    }
};

window.CAVE_ROOM_TEMPLATES = {
    "The Alchemist's Lab": {
        width: 7,
        height: 5,
        map: [
            ' WWWWW ',
            'WğŸ§ª.ğŸ§ªW', // Potions
            'W..W..W',
            'W.ğŸ§ª.ğŸ§ªW',
            ' WWWWW '
        ]
    },
    "Void Observation Deck": {
        width: 9,
        height: 5,
        map: [
            ' WWWWWWW ',
            'W.......W',
            'W..Î©.Î©..W', // Two Void Rifts
            'W.......W',
            ' WWWWWWW '
        ]
    },
    "Goblin Barracks": {
        width: 7,
        height: 7,
        map: [
            ' WWWWW ',
            'W.....W',
            'W.g.g.W',
            'W..ğŸ“•..W',
            'W.g.g.W',
            'W.....W',
            ' WWWWW '
        ]
    },
    "Skeleton Crypt": {
        width: 9,
        height: 7,
        map: [
            ' WWWWWWW ',
            'WW.....WW',
            'W...s...W',
            'W..sâ€ s..W', // Spawns a Bone Dagger!
            'W...s...W',
            'WW.....WW',
            ' WWWWWWW '
        ]
    },
    "Orc Stash": {
        width: 5,
        height: 5,
        map: [
            'WWWWW',
            'W.J.W', // Orc Journal
            'W.+o.W',
            'W.ğŸ“—.W',
            'WWWWW'
        ]
    },
    "Treasure Nook": {
        width: 3,
        height: 3,
        map: [
            'Wâ˜…W',
            '$ $',
            'Wâ˜†W'
        ]
    },
    "Flooded Grotto": {
        width: 9,
        height: 7,
        map: [
            ' WWWWWWW ',
            'W~~~~~~~W',
            'W~W...W~W',
            'W~W.S.W~W', // Stamina Crystal
            'W~W...W~W',
            'W~~~~~~~W',
            ' WWWWWWW '
        ]
    },
    "Bandit Stash": {
        width: 7,
        height: 7,
        map: [
            ' WWWWW ',
            'W.b.b.W',
            'W.<q<.W',
            'W..C..W', // Bandit Chief
            'W.$.$.W', // Gold
            'W.<...W',
            ' WWWWW '
        ]
    },
    "Abandoned Camp": {
        width: 5,
        height: 5,
        map: [
            'WWWWW',
            'W...W',
            'W.J.W', // A Journal
            'W.+ğŸ“„.W',
            'WWWWW'
        ]
    },
    "Acolyte's Nook": {
        width: 5,
        height: 5,
        map: [
            'WWWWW',
            'W...W',
            'W.a.W', // An Acolyte
            'W.j.W', // The new Journal
            'WWWWW'
        ]
    },
    "Champion's Crypt": {
        width: 7,
        height: 7,
        map: [
            ' WWWWW ',
            'W.<.<.W', // Traps!
            'W.....W',
            'W..s..W', // The Skeleton "Champion"
            'W..ğŸ’ª..W', // Guards the Tome of Strength!
            'W.<.<.W', // More traps!
            ' WWWWW '
        ]
    }
};
